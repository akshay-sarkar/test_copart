app.service("dataServiceG2",["$http","$q","$location","$locale","config","$sce","copartUtils","userService",function($http,$q,$location,$locale,config,$sce,copartUtils,userService){var log=new Logger({name:"G2DataService"});var userConfig=userService.userConfig;var self=this;self.SUCCESS=1;self.ERROR=-1;self.quickPicks={};self.yardLocations=null;var locale=new LocaleService($locale,$sce,config);locale.refDataMessages=locale.getResource("RefDataTranslations");self.getLocale=function(){return locale};
self.updateUserConfig=function(data,callBack){var deferred=$q.defer();var req={method:"POST",url:"/public/data/userConfigUpdate",data:copartUtils.updatedConfig(data),noCancelOnRouteChange:true};$http(req).then(function(response){deferred.resolve(response.data)},function errorCallback(response){deferred.reject("failed to update user config");log.error("failed to update user config"+response)});return deferred.promise};self.updateAccountAlertsUserConfig=function(data,callBack){var deferred=$q.defer();
var req={method:"POST",url:"public/data/userConfig/account-alerts",data:data,noCancelOnRouteChange:true};$http(req).then(function(response){deferred.resolve(response.data);console.log("Successully updated account alert",data,response)},function errorCallback(response){deferred.reject("failed to update user config");console.log("Failed to update account alert",data,response)});return deferred.promise};self.getSuggestion=function(val){var data=$.param({q:val});var deferred=$q.defer();var req={method:"POST",
url:"/public/data/lots/suggest",data:data,headers:{"Content-Type":"application/x-www-form-urlencoded; charset\x3dUTF-8"}};$http(req).then(function(response){deferred.resolve(response.data)},function errorCallback(response){deferred.reject("failed_to_get_suggestions_dataservice");log.error("Error for getSuggestion returned in dataservice"+response)});return deferred.promise};self.getQuickPicks=function(pageId,callBack){if(self.quickPicks[pageId])if(callBack)callBack(self.quickPicks[pageId]);else return;
$http.get("/public/data/quickPicks/"+pageId).then(function(response){self.quickPicks[pageId]=new QuickPicks(response.data.data.quickPicks,pageId);if(callBack)callBack(self.quickPicks[pageId])},function(response){if(callBack)callBack({});log.error("Error returned"+response)})};self.getQuickPickCounts=function(pageId,callback){$http.get("/public/data/quickPickCounts/"+pageId).then(function(response){self.totalItemsOnSale=response.data.data.totalItemsOnSale;if(callback)callback(response)},function(response){if(callback)callback({});
log.error("Error returned"+response)})};self.getdashBoardWatchList=function(callBack){$http.get("/data/lots/compactWatchList/").then(function(response){if(callBack)callBack(response)},function(response){if(callBack)callBack({});log.error("Error returned"+response)})};self.getdashBoardOpenItmList=function(callBack){$http.get("/data/compactOpenItems/").then(function(response){if(_.isFunction(callBack))callBack(response.data)},function(response){if(_.isFunction(callBack))callBack({});log.error("Error returned"+
response)})};self.getUserConfig=function(){$http.get("/public/data/userConfig").then(function(response){},function(response){if(callBack)callBack({});log.error("Error returned"+response)})};self.addAllCheckedToWatchlist=function(lots,callBack){var data={lots:lots};$http.post("/data/lots/add/checked/watchlist",data).then(function(response){if(callBack)callBack(response)},function(response){if(callBack)callBack({});log.error("Error returned"+response)})};self.addAllToWatchlist=function(data,callBack){var req=
{method:"POST",url:"/data/lots/add/all/watchlist",data:data};$http(req).then(function(response){if(callBack)callBack(response)},function(response){log.error("Error returned"+response)})};self.removeCheckedFromWatchlist=function(lots,callBack){var data={lots:lots};$http.post("/data/lots/remove/checked/watchlist",data).then(function(response){if(callBack)callBack(response)},function(response){if(callBack)callBack({});log.error("Error returned"+response)})};self.removeAllFromWatchlist=function(data,
callBack){var req={method:"POST",url:"/data/lots/remove/all/watchlist",data:data};$http(req).then(function(response){if(callBack)callBack(response)},function(response){log.error("Error returned"+response)})};self.searchSavedSearches=function(callBack){$http({url:"/lot/savedSearches",method:"GET"}).success(function(result,status,headers,config){if(result.returnCode==1){if(callBack)callBack(result)}else log.error("Error")}).error(function(result,status,headers,config){log.error("Error returned searchSavedSearches"+
result+", status\x3d"+status)})};self.emailSavedSearch=function(search,callBack){var req={method:"POST",url:"/lot/emailSavedSearch/",data:search};$http(req).then(function(response){if(callBack)callBack(response)},function(response){log.error("Error returned in emailSavedSearch"+response)})};self.deleteSavedSearch=function(id,callBack){$http.get("/lot/deleteSearch/"+id).success(function(response){if(callBack)callBack()}).error(function(response){log.error("Error returned"+response)})};self.saveSearch=
function(data,callBack){var req={method:"POST",url:"/lot/saveCriteria",data:data};$http(req).then(function(response){if(callBack)callBack(response)},function(response){log.error("Error returned"+response)})};self.updateAuctionCount=function(callBack){var sortOrder={"sortColumn":1,"sortOrder":"A"};$http.post("/public/data/todayAuctions",sortOrder).then(function(response){if(callBack)callBack(response)},function(response){if(callBack)callBack({});log.error("Error returned"+response)})};self.loadReferenceDataLess=
function(callBack){jQuery.ajax({cache:false,url:"/public/data/referenceData/less",success:function(response){if(callBack)callBack(response)},async:false})};self.loadReferenceData=function(callBack){$http({url:"/public/data/referenceData",method:"GET",noCancelOnRouteChange:true}).then(function(response){if(callBack)callBack(response)})};self.getEnvConfigProps=function(callBack){$http({url:"/public/data/envconfig/properties",method:"GET",noCancelOnRouteChange:true}).then(function(response){if(callBack)callBack(response.data.data)})};
self.getLotDetails=function(lotNumber,callback){$http.get("/public/data/lotdetails/solr/"+lotNumber).then(function(response){if(callback)callback(response)})};self.getLotComparisionDetails=function(lotsToCompare,callback){$http.get("/public/data/compareLots/"+lotsToCompare).then(function(response){if(callback)callback(response)})};self.getDynamicLotDetails=function(lotNumber,callback){$http.get("/data/lotdetails/dynamic/"+lotNumber).then(function(response){if(callback)callback(response)})};self.getConditionalReportForLot=
function(documentInquiryVO,callBack){if(!documentInquiryVO)return;var url="/public/data/lotDetails/conditionalReport/"+documentInquiryVO.lotNumber;url=copartUtils.appendQueryStringToURL(url,documentInquiryVO);$http.get(url).then(function(response){if(callBack)callBack(response)})};self.getLotVideo=function(lotNumber,callBack){$http.get("/public/data/lotdetails/solr/lotVideo/"+lotNumber).then(function(response){if(callBack)callBack(response)})};self.getLotByIndex=function(index,callback){$http.get("/public/data/lotdetails/index/"+
index).then(function(response){response.index=index;if(callback)callback(response)})};self.getLotsByLotNumber=function(data,callBack){$http.post("/public/lots/number/search",data).then(function(response){if(callBack)callBack(response)},function(response){log.error("Error returned"+response)})};self.getLotsByVIN=function(data,callBack){$http.post("/public/lots/vin/search",data).then(function(response){if(callBack)callBack(response)},function(response){log.error("Error returned"+response)})};self.getOffisteYard=
function(lotNumber,callback){$http.get("/public/data/lotdetails/offisteYard/"+lotNumber).then(function(response){if(callback)callback(response)})};self.generateSaleDate=function(saleDateObj,callBack){$http.post("/public/data/lotdetails/generateSaleDate",saleDateObj).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.emailPassword=function(userIDOrEmail,callBack){$http.post("/public/data/emailPassword",userIDOrEmail).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+
response)})};self.getLotImages=function(lotNumber,callback,countryCode){var url="/public/data/lotdetails/solr/lotImages/"+lotNumber;if(countryCode)url=url+"/"+countryCode;$http.get(url).then(function(response){if(callback)callback(response)})};self.getCountriesForShipping=function(callback){var url="/g2mext/supportedPorts";$http.get(url).then(function(response){if(callback)callback(response)})};self.getQuoteForShipping=function(data,callBack){$http.post("/g2mext/getQuote",data).success(function(response){if(callBack)callBack(response);
jQuery(".spin-head").addClass("hide")}).error(function(response){log.error("Error returned"+response);jQuery(".spin-head").addClass("hide")})};self.getDeliveryEstimate=function(requestParam,currentEstimatesList,callBack){var estimate={"newZipCode":requestParam.newZipCode,"lotNumber":requestParam.lotNumber,"requestType":requestParam.requestType,"orderScreen":requestParam.orderScreen,"module":requestParam.module,"yardNumber":requestParam.yardNumber};if(estimate.orderScreen)estimate.locationKey=requestParam.locationKey;
if(currentEstimatesList&&currentEstimatesList[requestParam.lotNumber]&&!requestParam.newZipCode)if(callBack){var response={data:currentEstimatesList[requestParam.lotNumber],returnCode:1};callBack(response);return}if(!requestParam.newZipCode)return;$http.post("/public/data/delivery/estimate",estimate).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.redirectQuote=function(data,callBack){$http.post("/g2mext/redirectQuote",
data).success(function(response){if(callBack)callBack(response)}).error(function(error){log.error("Error returned"+error)})};self.changePassword=function(accountInfoVO,callBack){$http.post("/data/accountInfo/updatePassword",accountInfoVO).then(function(response){if(callBack)callBack(response)},function(response){console.log("Error updating password")})};self.getCreditCardDetailsForDepositRefund=function(){var deferred=$q.defer();$http.post("/data/getCreditCardDetailsForDepositRefund").then(function(response){deferred.resolve(response)},
function(response){console.log("Error getCreditCardDetailsForDepositRefund");deferred.reject(response)});return deferred.promise};self.getDepositRefundBalance=function(){var deferred=$q.defer();$http.post("/data/getDepositRefundBalance").then(function(response){deferred.resolve(response)},function(response){console.log("Error getDepositRefundBalance");deferred.reject(response)});return deferred.promise};self.getDepositRefundTransactionHistory=function(cardID,callBack){var data={"cardID":cardID};$http.get("/data/getRefundHistory",
{params:data}).then(function(response){if(callBack)callBack(response)},function(response){console.log("Error getDepositRefundTransactionHistory")})};self.submitDepositRefund=function(depositRefundDTO,callBack){$http.post("/data/submitDepositRefund",depositRefundDTO).then(function(response){if(callBack)callBack(response)},function(response){console.log("Error submitDepositRefund")})};self.getLocationsList=function(continentCode,callBack){var data={"continentCode":continentCode};$http.get("/public/data/locations/retrieveLocationsList",
{params:data}).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.retrieveMultipleContinentsLocationsList=function(continentCode,callBack){var data={"continentCode":continentCode};$http.get("/public/data/locations/retrieveMultipleContinentsLocationsList",{params:data}).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getRegions=function(callBack){$http.get("/public/data/regions").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+
response)})};self.getLocationDetail=function(yardNumber,callBack){var data={"yardNumber":yardNumber};$http.get("/public/data/locations/retrieveLocationDetail",{params:data}).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getNearestLocationDetail=function(data,callBack){var req={method:"POST",url:"/public/data/locations/nearest/zip",data:data};$http(req).then(function(response){if(callBack)callBack(response)},function(response){log.error("Error returned"+
response)})};self.getAccountInfoForms=function(callBack){$http.get("/data/myAccount/forms").then(function(response){if(callBack)callBack(response.data)},function(response){console.log("Error retrieving forms")})};self.getContactInfo=function(callBack){$http.get("/data/contactinfo").then(function(response){if(callBack)callBack(response.data)},function(response){console.log("Error retrieving Contact info")})};self.getAccountInformation=function(callBack,errorCallback){$http.get("/public/data/contactinfo").then(function(response){if(callBack)callBack(response.data)},
function(errors){if(errorCallback)errorCallback(errors);console.log("Error retrieving Contact info")})};self.getMemberPreferences=function(callBack){$http.get("/data/getMemberPreference").then(function(response){if(callBack)callBack(response.data)},function(response){console.log("Error retrieving Member Preferences")})};self.getAvailablePaymentTypes=function(callBack){$http.get("/data/getAvailablePaymentTypes").then(function(response){if(callBack)callBack(response.data)},function(response){console.log("Error retrieving Member Preferences")})};
self.loadPaymentDueData=function(currency,callBack){$http({url:"/data/payments/loadInitialData/"+currency,method:"GET"}).success(function(data,status,headers,config){var data=data;if(callBack)callBack(data)}).error(function(data,status,headers,config){log.error("error to load loadReferenceData")})};self.loadPaymentDueMEAData=function(currency,callBack){$http({url:"/data/payments/loadInitialData/"+currency,method:"GET"}).success(function(data,status,headers,config){var data=data;if(callBack)callBack(data)}).error(function(data,
status,headers,config){log.error("error to load loadReferenceData")})};self.updateMemberPreference=function(accountPrefVO,callBack){$http.post("/data/updateMemberPreference",accountPrefVO).then(function(response){if(callBack)callBack(response)},function(response){console.log("Error updating Memeber Preferences")})};self.updateMemberPaymentType=function(paymentVO,callBack){$http.post("/data/updateMemberPaymentType",paymentVO).then(function(response){if(callBack)callBack(response)},function(response){console.log("Error updating Default Payment Type")})};
self.signUpForVehicleAlerts=function(vehicleAlertVO,callBack){$http.post("/public/data/vehicleAlertsSignUp",vehicleAlertVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response);if(callBack)callBack(response)})};self.unsubscribeVehicleAlerts=function(subscriberKey,callBack){$http.post("/public/data/vehicleAlertsUnsubscribe",subscriberKey).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+
response);if(callBack)callBack(response)})};self.editVehicleAlerts=function(smsAlertVO,callBack){$http.post("/public/data/vehicleAlertsEdit",smsAlertVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response);if(callBack)callBack(response)})};self.signUpToSellVehicleAsBusinessOrDealer=function(SellVehicleVO,callBack){$http.post("/public/registerAsBusiness",SellVehicleVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+
response)})};self.signUpToSellVehicleAsIndividual=function(SellVehicleVO,callBack){$http.post("/public/registerAsIndividual",SellVehicleVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getPaymentCapRestriction=function(paymentCapInquiryVO,callBack){$http.post("/data/payments/cap",paymentCapInquiryVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};
self.getFinanceInfo=function(callBack){$http.get("/data/financeInfo/").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.verifyFinanceAccount=function(accountInfoVO,callBack){$http.post("/data/verifyFinance/",accountInfoVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.confirmCounterBid=function(bidInquiryVO,callBack){$http.post("/data/lots/counterBid",
bidInquiryVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getLicenseInfo=function(callBack,failureCallBack){$http.get("/data/licenseInfo/").then(function(response){callBack(response.data)},function(response){failureCallBack("Error while retrieving data"+response.data)})};self.uploadLicense=function(formData,callBack){var url="/data/uploadLicense";$http({url:url,method:"POST",data:formData,transformRequest:angular.identity,
headers:{"Content-Type":undefined}}).success(function(data,status,headers,config){callBack(data)}).error(function(data,status,headers,config){alert("error while uploading license document")})};self.documentsUpload=function(formData,callBack){var url="/public/data/upload-document";$http({url:url,method:"POST",data:formData,transformRequest:angular.identity,headers:{"Content-Type":undefined}}).success(function(data,status,headers,config){callBack(data)}).error(function(data,status,headers,config){alert("error while uploading license document")})};
self.invoiceDetails=function(invoiceParam,callBack){$http({url:"/data/payments/invoiceDetails",method:"POST",data:{"paymentType":invoiceParam.paymentType,"invoiceNumber":invoiceParam.invoiceId,"currencyCode":invoiceParam.selectedCurrency,"invoiceType":invoiceParam.invoiceType,"lotNumber":invoiceParam.lotNumber}}).success(function(data,status,headers,config){var data=data;if(callBack)callBack(data)}).error(function(data,status,headers,config){})};self.paySelectedInvoices=function(invoiceParam,callBack){console.log(invoiceParam);
$http({url:"/data/payments/paySelectedInvoices/"+invoiceParam.paymentType+"/"+invoiceParam.invoiceIds+"/"+invoiceParam.invoiceTotal,method:"POST"}).success(function(data,status,headers,config){var data=data;if(callBack)callBack(data)}).error(function(data,status,headers,config){})};self.paySelectedInvoicesUsingAFC=function(invoiceParam,callBack){console.log(invoiceParam);$http({url:"/data/payments/floorPlan/"+invoiceParam.paymentType+"/"+invoiceParam.dealerId+"/"+invoiceParam.invoiceIds,method:"POST"}).success(function(data,
status,headers,config){var data=data;if(callBack)callBack(data)}).error(function(data,status,headers,config){log.error("Error returned:: paySelectedInvoicesUsingAFC :",data)})};self.paidInvoicesList=function(requesrParam,callBack){console.log(requesrParam);$http({url:"/data/payments/paidInvoicesList?transactionId\x3d"+requesrParam.transactionId+"\x26paidInvoiceSecretId\x3d"+requesrParam.paidInvoiceSecretId,method:"GET"}).success(function(data,status,headers,config){var data=data;if(callBack)callBack(data)}).error(function(data,
status,headers,config){})};self.setPciParam=function(requestParam,callBack,url){if(requestParam.cookieValue==undefined)requestParam.cookieValue=$location.path();$http.post(url?url:"/data/payments/setPciParam/",requestParam).success(function(response){if(response.data.systemUp===false){$location.path("scheduleMaintainance");return}if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.paySelectedInvoicesMEA=function(requestParam,callBack,url){$http({data:requestParam,
url:"/data/paymentsMEA/payInvoices",method:"POST"}).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("error to load paySelectedInvoices"+response)})};self.callMEAPaymentSite=function(signedParams,callBack,url){$http({url:"https://testsecureacceptance.cybersource.com/pay?signature\x3d"+signedParams,method:"POST"}).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("error to load paySelectedInvoices"+response)})};
self.emailInvoice=function(requestParam,callBack,url){$http.post(url?url:"/data/payments/emailInvoice",requestParam).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.memberRegistrationChoices=function(callBack){$http.get("/public/data/memberRegistrationChoices").success(function(response){if(callBack)callBack.onSuccess(response)}).error(function(response){log.error("Error returned"+response)})};self.saveMessageChoices=
function(data,callBack){$http({url:"/data/saveMessageChoices",method:"POST",data:data}).success(function(response){if(callBack)callBack.onSuccess(response)}).error(function(response){if(callBack)callBack.onFailure(response)})};self.registerNewMember=function(memberRegistrationVO,callBacks){$http({url:"/public/data/member/registration",method:"POST",data:memberRegistrationVO}).success(function(data,status,headers,config){callBacks.onSuccess(data)}).error(function(data,status,headers,config){callBacks.onFailure(data)})};
self.registerAndUploadLicense=function(formData,callBack){var url="/public/data/registerAndUploadLicense";$http({url:url,method:"POST",data:formData,transformRequest:angular.identity,headers:{"Content-Type":undefined}}).success(function(data,status,headers,config){callBack(data)}).error(function(data,status,headers,config){alert("error while uploading license document")})};self.silentPay=function(formData,callBack){var url="https://testsecureacceptance.cybersource.com/silent/pay";$http({url:url,method:"POST",
data:formData,headers:{"Content-Type":"application/x-www-form-urlencoded; charset\x3dutf-8"}}).success(function(data,status,headers,config){callBack(data)}).error(function(data,status,headers,config){alert("error while uploading license document")})};self.verifyIdentity=function(formData){var url="/g2mext/api/v1/public/tudata";$http.post(url,formData).success(function(data){}).error(function(data){console.warn("Could not call TU Data Service")})};self.saveSecurityQuestions=function(securityQuestions,
callBack){$http({url:"/data/securityQuestions",method:"POST",data:securityQuestions}).success(function(response){callBack.onSuccess(response)}).error(function(response){callBack.onFailure(response)})};self.createPassword=function(formData,callBack){$http({url:"/public/data/createPassword",method:"POST",data:formData}).success(function(response){callBack.onSuccess(response)}).error(function(response){callBack.onFailure(response)})};self.getSavedSecurityQuestions=function(email,callBack){$http({url:"/public/data/securityQuestions?email\x3d"+
email,method:"GET"}).success(function(response){callBack.onSuccess(response)}).error(function(){callBack.onFailure(response)})};self.verifySecurityQuestions=function(questions,callBack){$http({url:"/public/data/securityQuestions/verify",method:"POST",data:questions}).success(function(response){callBack.onSuccess(response)}).error(function(response){callBack.onFailure(response)})};self.saveContactInfo=function(accountInfoVO,callBack){$http.post("/data/updatecontactinfo",accountInfoVO).then(function(response){if(callBack)callBack(response)},
function(response){console.log("Error updating contact information")})};self.createUpdateCountermanAccount=function(countermanVO,callBack){$http.post("/data/counterman/createUpdateAccount",countermanVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.deleteCountermanAccount=function(callBack){$http.get("/data/counterman/deleteAccount").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+
response)})};self.getCountermanAccount=function(callBack){$http.get("/data/counterman/getAccount").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getMemberSubscription=function(callBack){$http.get("/data/accounts/subscriptions/type/marketing").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.saveOrUpdateMemberSubscription=function(memberSubscriptionVO,
isUpdate,callBacks){$http({url:"/data/accounts/subscriptions/type/marketing",method:isUpdate?"PUT":"POST",data:memberSubscriptionVO}).success(function(data){callBacks.onSuccess(data)}).error(function(data){callBacks.onFailure(data)})};self.getMarketGuideDetails=function(lotNumber,callBack){$http.get("/public/data/lotDetails/getMarketguide/"+lotNumber).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getBidEligibility=
function(lotNumber,countryCode,callBack){$http.get("/data/member/lot/bid-eligibility/verify?lotNumber\x3d"+lotNumber+"\x26countryCode\x3d"+countryCode).success(function(response){if(callBack)callBack(response)})};self.createMGuidePurchaseRequest=function(marketGuideInquiryVO,callBack){$http.post("/public/data/lotDetails/purchaseMarketguide/",marketGuideInquiryVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.validateMGuidePurchaseRequest=
function(marketGuideInquiryVO,callBack){$http.post("/public/data/validate/purchaseMarketguide/",marketGuideInquiryVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getVinDetails=function(vin,callBack){$http.get("/public/data/lotDetails/getVinDetails/"+vin).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getNADAValues=function(lotNumber,
callBack){$http.get("/public/data/lotDetails/getNadaValues/"+lotNumber).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getProquoteSalesList=function(lotNumber,callBack){$http.get("/public/data/lotDetails/getProquoteSalesList/"+lotNumber).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.createAutoCheckKeyFile=function(autoCheckKeyVO,callBack){$http.post("/public/data/lotDetails/createAutoCheckKeyFile/",
autoCheckKeyVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getPaymentSystem=function(paymentSystemInquiryDTO,callBack){$http.post("/public/data/payment/getPayment/",paymentSystemInquiryDTO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.retrieveLotIconCodes=function(lotNumber,callBack){$http.get("/public/data/lotdetails/retrieveLotIconCodes/"+
lotNumber).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.multilotbid=function(bidInquiryRequest,callBacks){$http({url:"/data/lots/prelim-bid",method:"POST",data:bidInquiryRequest}).success(function(data,status,headers,config){callBacks.onSuccess(data)}).error(function(data,status,headers,config){callBacks.onFailure(data)})};self.updatedBidInfo=function(data,callBacks){$http({url:"/public/lots/bidDetails",method:"POST",
data:data}).success(function(data,status,headers,config){callBacks.onSuccess(data)}).error(function(data,status,headers,config){callBacks.onFailure(data)})};self.getInspectors=function(facilityNumber,requestedPage,callBack){var data={"facilityNumber":facilityNumber,"requestedPage":requestedPage};$http.get("/public/data/inspectors/",{params:data}).then(function(response){if(callBack)callBack(response.data)},function(response){console.log("Error retrieving Contact info")})};self.getInspectorDetails=
function(inspectorNumber,callBack){var data={"inspectorNumber":inspectorNumber};$http.get("/public/data/inspectorDetails/",{params:data}).then(function(response){if(callBack)callBack(response.data)},function(response){console.log("Error retrieving Contact info")})};self.getBidderStatusList=function(callBack){$http.get("/data/bidders").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.updateBidderStatus=function(bidderVO,
callBack){$http.post("/data/bidders/status",bidderVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.assignBidderSlot=function(bidderVO,callBack){$http.post("/data/bidders/assign-bidder",bidderVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.updateBidderAllocatedLimit=function(bidderVO,callBack){$http.post("/data/bidders/bidlimit",
bidderVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.changeBidderPassword=function(bidderVO,callBack){$http.post("/data/bidders/password",bidderVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.resetBidderStatus=function(bidderVO,callBack){$http.post("/data/bidders/status/reset",bidderVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+
response)})};self.getBidderCounts=function(bidderVO,callBack){$http.post("/data/bidders/status/counts",bidderVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.prelimBidForLot=function(bidInquiryVOArray,callBack,callBack1){$http.post("/data/lots/prelim-bid",bidInquiryVOArray).success(function(response){if(callBack)callBack(response,callBack1)}).error(function(response){log.error("Error returned"+response)})};self.getWatchListForBuyer=
function(callBack){$http({method:"GET",url:"/data/lots/watchList",noCancelOnRouteChange:true}).then(function successCallback(response){if(callBack)callBack(response)},function errorCallback(response){log.error("Error is fetching WatchList"+JSON.stringify(response))})};self.addToWatchList=function(lotNumber,callBack){$http({method:"POST",url:"/data/lots/addToWatchList/"+lotNumber}).then(function successCallback(response){if(callBack){if(response.data.returnCode!=1)response.data.data.message=locale.messages["app.watchlist.modified.sproc.error."+
response.data.data.code]?locale.messages["app.watchlist.modified.sproc.error."+response.data.data.code]:response.data.data.message;callBack(response)}},function errorCallback(response){log.error("Error: Failed to add lot in watch list")})};self.removeFromWatchList=function(lotNumber,callBack){$http({method:"POST",url:"/data/lots/removeFromWatchList/"+lotNumber}).then(function successCallback(response){if(callBack)callBack(response)},function errorCallback(response){log.error("Error: Failed to removed lot from watch list")})};
self.confirmBuyItNowPurchase=function(bidInquiryVO,callBack){$http.post("/data/submitBuyItNow",bidInquiryVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.searchCountermanInventory=function(countermanInventoryVO,callBack){$http.post("/data/searchCountermanInventory",countermanInventoryVO).then(function(response){if(callBack)callBack(response)},function(response){console.log("Error Searching Counterman Inventory")})};
self.getAllBrokers=function(requestedPage,callBack){var data={"requestedPage":requestedPage};$http.get("/public/data/allbrokers",{params:data}).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error while fetching All Brokers List"+response)})};self.getResellerServices=function(brokerNumber,callBack){$http.get("/public/data/resellerservices/"+brokerNumber).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error while fetching reseller services"+
response)})};self.getResellerPaymentMethods=function(brokerNumber,callBack){$http.get("/public/data/resellerpaymentmethods/"+brokerNumber).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error while fetching Reseller payment methods"+response)})};self.getMarketMakerslist=function(requestedPage,callBack){var data={"requestedPage":requestedPage};$http.get("/public/data/marketmakers",{params:data}).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error while fetching Market Makers List"+
response)})};self.getMarketMakerDetails=function(marketMaker,callBack){$http.get("/public/data/marketmakerdetails/"+marketMaker).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error while fetching Market maker details"+response)})};self.getResellerAccountInfo=function(brokerNumber,callBack){$http.get("/public/data/resellerinfo/"+brokerNumber).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error while fetching Reseller account info"+
response)})};self.getCldrData=function(language,locale,callBack){$http({method:"GET",url:"/public/data/cldrData/"+language+"/"+locale,noCancelOnRouteChange:true}).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.downloadLotImages=function(lotNumber,callBack){$http.get("/public/data/lotImages/download/"+lotNumber).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+
response)})};self.getBrokerProfile=function(callBack){$http.get("/data/brokerProfile").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.updateBrokerInfo=function(brokerAdditionalInfoVO,callBack){$http.post("/data/brokerMoreInfo",brokerAdditionalInfoVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.towProviderContactUS=function(contactUsInquiry,
callBack){$http.post("/public/data/towproviderContactus",contactUsInquiry).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned in Tow providers contactus"+response)})};self.getDeliveryLocations=function(lotnumber,callBack){$http.get("/data/lot/transportation/deliveryLocations/"+lotnumber).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.updateQuote=function(){$http.post("/data/lot/transportation/addDeliveryLocation",
deliveryLocation).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.submitOrder=function(deliveryLocation,callBack){$http.post("/data/lot/transportation/submitOrder",deliveryLocation).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.validateAddress=function(deliveryLocation,callBack){$http.post("/data/lot/transportation/validateAddress",deliveryLocation).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+
response)})};self.cancelOrder=function(lotId,callBack){$http.get("/data/lot/transportation/cancelOrder/"+lotId).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.updateContactEmail=function(accountInfoVO,callBack){$http.post("/data/updateEmail",accountInfoVO).then(function(response){if(callBack)callBack(response)},function(response){console.log("Error updating contact information")})};self.updateBidderEmail=function(accountInfoVO,
callBack){$http.post("/data/bidders/updateEmail",accountInfoVO).then(function(response){if(callBack)callBack(response)},function(response){console.log("Error updating email information")})};self.updateBidderAccount=function(accountInfoVO,callBack){$http.post("/data/bidders/updateAccount",accountInfoVO).then(function(response){if(callBack)callBack(response)},function(response){console.log("Error updating account information")})};self.getSalesDataConfig=function(callBack){$http.get("/data/sales/config").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+
response)})};self.getCreditCardList=function(callBack){$http.get("/data/creditCardList").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getCreditCards=function(callBack){$http.get("/data/creditCards").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.increaseBuyingPower=function(requestParam,callBack){$http.post("/data/bidLimitBatchNumber/",
requestParam).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("upgradePremierAccount :: Error returned"+response)})};self.getAuctionsCalendarList=function(callBack){var req={method:"GET",url:"/public/data/auctionsCalendarList",noCancelOnRouteChange:true,ignoreLoadingBar:true};$http(req).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.acceptTermsAndConditions=function(callBack){var data=
{};var req={method:"POST",url:"/data/terms/accept"};$http(req).then(function(response){if(callBack)callBack(response)},function(response){log.error("Error returned"+response)})};self.acceptEpayTerms=function(callBack){$http.get("/data/payments/acceptEpayTerms/").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getBidderPaymentCounts=function(callBack){$http.get("/data/payments/invoice/counts").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+
response)})};self.getPaymentSaleTypes=function(callBack){$http.get("/data/payments/saleTypeList").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.checkYardBySiteCode=function(requestParam,callBack){$http({url:"/data/payments/checkYardBySiteCode/"+requestParam.yardNumber,method:"POST"}).success(function(data,status,headers,config){var data=data;if(callBack)callBack(data)}).error(function(data,status,headers,config){log.error("Error returned"+
response)})};self.getHireabrokerList=function(lotNumber,yardState,yardCountry,callBack){$http.get("/data/hireABroker/"+lotNumber+"/"+yardState+"/"+yardCountry).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getSpecificBrokerInfo=function(brokerID,callBack){$http.get("/data/getSpecificBrokerInfo/"+brokerID).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+
response)})};self.submitMakeAnOffer=function(bidInquiry,callBack){$http.post("/data/lots/makeAnOffer",bidInquiry).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getCurrentBidDetails=function(currentBidInquiry,callBack){$http.post("/data/currentBidDetails",currentBidInquiry).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("getCurrentBidDetails Error returned"+response)})};
self.postFeedback=function(data,callBack){$http.post("/public/data/feedback",data).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("postFeedback Error returned"+response)})};self.getAvailableBalance=function(accountInfoInquiry,callBack){$http.post("/data/availableBalance/",accountInfoInquiry).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("getAvailableBalance/My Account/Financing Error returned"+response)})};
self.getTodayAuctionData=function(url,callBack){$http.get(url).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.saleReceipt=function(saleReceiptParam,callBack){console.log(saleReceiptParam);$http({url:"data/payments/saleReceipt",method:"POST",data:{"invoiceNumber":saleReceiptParam.invoiceId}}).success(function(data,status,headers,config){var data=data;if(callBack)callBack(data)}).error(function(data,status,headers,config){log.error("Error returned in sale Receipt"+
response)})};self.getAdditionalLotNotes=function(lotNumber,callBack){$http.get("public/data/lot/additionalLotNotes/"+lotNumber).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.downloadCSV=function(url,successCallBack,failureCallBack){$http.get(url).then(function(response){if(successCallBack)successCallBack(response)},function(response){if(failureCallBack)failureCallBack({});log.error("Error returned"+response)})};self.getVehicleModels=
function(makeId,callback){$http.get("/public/data/VehicleModels/"+makeId).success(function(response){if(callback)callback(response)}).error(function(response){log.error("Error returned"+response)})};self.getVehicleMakes=function(vehTypeId,callback){$http.get("/public/data/VehicleMakes/"+vehTypeId).success(function(response){if(callback)callback(response)}).error(function(response){log.error("Error returned"+response)})};self.getStates=function(countryId,callback){$http.get("/public/data/states/"+
countryId).success(function(response){if(callback)callback(response)}).error(function(response){log.error("Error returned"+response)})};self.confirmEmailSubscription=function(confirmationKey,callBack){$http.post("/public/data/ConfirmEmailSubscription",confirmationKey).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("public/data/ConfirmEmailSubscription Error returned"+response)})};self.unSubscribeEmailSubscription=function(subscriptionCodesVO,callBack){$http.post("/data/unSubscribeEmailSubscription",
accountInfoInquiry).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("/data/unSubscribeEmailSubscription Error returned"+response)})};self.confirmUnSubscribeEmailSubscription=function(key,callBack){$http.post("/public/data/ConfirmEmailUnSubscription",key).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("/data/ConfirmEmailUnSubscription Error returned"+response)})};self.getEmailSubscriptions=function(callBack){$http.get("/data/getMemberSubscriptionList").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Email subscriptions Error returned"+
response)})};self.updateTextSubscriptions=function(data,callBack){$http.post("/data/update-text-subscription",data).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Text subscriptions Error returned"+response)})};self.getTextSubscriptions=function(data,callBack){$http.post("/data/update-text-subscription",data).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Text subscriptions Error returned"+response)})};
self.getMemberTextSubscriptions=function(callBack){$http.get("/data/update-text-subscription").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Text subscriptions Error returned"+response)})};self.getContactInformation=function(callBack){$http.get("/data/member/contact-preferences").success(function(response){if(callBack)callBack(response)}).error(function(response){callBack(response);log.error("getContactInformation Error returned"+response)})};self.updateMobileNo=
function(data,callBack){$http.post("/data/member/mobile-no",data).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("updateMobileNo Error returned"+response)})};self.postTowProviderData=function(towProviderVO,callBack){$http.post("/public/data/validateTowProvider",towProviderVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.saveSubscriptions=function(emailSubscriptions,
callBack){$http.post("/data/updateMemberSubscriptionList",emailSubscriptions).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error(",Email subscriptions Error returned"+response)})};self.updateLanguagePreference=function(selectedLanguage,callBack){$http({url:"/data/updateLanguagePreference",method:"POST",data:selectedLanguage}).success(function(data,status,headers,config){var data=data;console.log(data);if(callBack)callBack(data)}).error(function(data,status,
headers,config){log.error("Error returned in sale Receipt"+response)})};self.getInvoicePDF=function(data,callBack){$http({url:"data/payments/invoiceDetailsPDF",method:"POST",data:{"paymentType":invoiceParam.paymentType,"invoiceNumber":invoiceParam.invoiceId,"currencyCode":invoiceParam.selectedCurrency,"invoiceType":invoiceParam.invoiceType,"lotNumber":invoiceParam.lotNumber}}).success(function(data,status,headers,config){var data=data;alert("loading PDF.......");if(callBack)callBack(data)}).error(function(data,
status,headers,config){log.error("Error returned in getInvoicePDF"+response)})};self.createNewServiceOrder=function(CRInquiryVO,callBack){$http.post("lotDetails/createServiceOrderForCR/",CRInquiryVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned in createNewServiceOrder"+response)})};self.conditionReportPreChecks=function(lot,dynamicLotDetails,queryString,callBack){$http.get("/data/conditionReportPreChecks/"+lot.ln+"/"+queryString).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned in fetchConditionReport"+
response)})};self.getTransactionIdForCR=function(conditionReportVO,callBack){$http.post("/data/getTransactionIdForCR",conditionReportVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned in fetchConditionReport"+response)})};self.conditionReportEmailAPI=function(CRInquiryVO,callBack){$http.post("conditionReport/CREmailAPI/",CRInquiryVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned in conditionReportEmailAPI"+
response)})};self.getConditionReportData=function(lotNumber,callback){if(_.isFunction(callback)){if(!lotNumber){callback(null);return}$http.get("/data/getConditionReport/"+lotNumber).success(function(response){callback(response)}).error(function(response){log.error("Failed to get condition report data:",response);callback(response)})}};self.getConditionReportApi=function(lotNumber,headersParams,callback){$http({url:"/public/data/conditionReportApiService/"+lotNumber,method:"GET",headers:{"Authorization":headersParams.conditionReportToken,
"countryCode":headersParams.country,"source":headersParams.source,"partnerCode":headersParams.partner}}).success(function(response){if(callback)callback(response)}).error(function(response){log.error("Failed to get condition report data response:",response);callback(response)})};self.createCREmail=function(CRInquiryVO,callBack){$http.post("conditionReport/CREmailAPI/",CRInquiryVO).success(function(response){if(_.isFunction(callBack))callBack(response)}).error(function(response){log.error("Error returned in CREmail call ",
response)})};self.leadFormEmailApi=function(formData,callBack){var url="/public/sendEmailUsingEmailWS";$http({url:url,method:"POST",data:formData,transformRequest:angular.identity,headers:{"Content-Type":undefined}}).success(function(data,status,headers,config){callBack(data)}).error(function(data,status,headers,config){log.error("Failed to submit Lead Form: ",data)})};self.fetchLocationsByInventory=function(callBack){$http.get("/public/data/locations/retrieveByInventory").success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error fetching yards by Inventory"+
response)})};self.capturePreRegistrationData=function(memberRegistrationVO,callBacks){$http({url:"/public/data/member/preRegistration",method:"POST",data:memberRegistrationVO}).success(function(data){callBacks.onSuccess(data)}).error(function(data){callBacks.onFailure(data)})};self.refreshMemberTimestamp=function(){$http({url:"/public/data/v1/gen/mts",method:"POST",data:{}}).success(function(data){console.log("Call to refMemTmstmp returned - "+data)}).error(function(data){console.log("Call to refMemTmstmp failed - "+
data)})};self.getPreRegistrationData=function(email,userId,callBack){$http.get("/public/data/member/preRegistration?email\x3d"+email+"\x26userId\x3d"+userId).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error fetching the preRegistraion data"+response)})};self.performLogin=function(url,form,successCallback,errorCallback){$http.post(url,form).success(function(response){if(_.isFunction(successCallback))successCallback(response)}).error(function(response){if(_.isFunction(errorCallback))errorCallback(response)})};
self.logBidEligibility=function(bidInquiryVOArray,lotDetails){$http.post("/g2mext/api/v1/bidEligibility",bidInquiryVOArray,{headers:{"country":lotDetails.locCountry}}).success(function(response){console.log("Successfully submitted bid eligibility data")}).error(function(response){log.error("Error submitting the bidEligibility data"+response)})};self.lotCurrentShippingStatus=function(buyerNumber,lotNumber,callback){$http.get("/g2mext/internationalShipping/"+buyerNumber+"/currentStatus/"+lotNumber).success(function(response){if(callback)callback(response);
jQuery(".spin-head").addClass("hide")}).error(function(response){log.error("Error returned"+response);if(callback)callback(response);jQuery(".spin-head").addClass("hide")})};self.lotRecommendationSearch=function(lotSearchCriteria,callBack){lotSearchCriteria=lotSearchCriteria||{};var lotRecommendationSearchCriteria={};lotRecommendationSearchCriteria.searchType=lotSearchCriteria.searchType;lotRecommendationSearchCriteria.buyerNumber=lotSearchCriteria.buyerNumber;if(lotSearchCriteria.lotNumber)lotRecommendationSearchCriteria.lotNumber=
lotSearchCriteria.lotNumber;lotRecommendationSearchCriteria.country=lotSearchCriteria.country;lotRecommendationSearchCriteria.state=lotSearchCriteria.state?lotSearchCriteria.state:"";if(lotSearchCriteria.coordinates!="undefined, undefined")lotRecommendationSearchCriteria.coordinates=lotSearchCriteria.coordinates;var url="/g2mext/api/v1/public/lotRecommendations";var req={method:"POST",url:url,headers:{"siteCode":userConfig.siteCode,"languageCode":userConfig.selectedLang},data:lotRecommendationSearchCriteria};
$http(req).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error fetching lotRecommendationSearch"+response)})};self.popularSearches=function(popularSearchCriteria,callBack){popularSearchCriteria=popularSearchCriteria||{};var popularRecommendationSearchCriteria={};popularRecommendationSearchCriteria.searchType=popularSearchCriteria.searchType;popularRecommendationSearchCriteria.buyerNumber=popularSearchCriteria.buyerNumber;popularRecommendationSearchCriteria.country=
popularSearchCriteria.country;popularRecommendationSearchCriteria.state=popularSearchCriteria.state?popularSearchCriteria.state:"";if(popularSearchCriteria.coordinates!="undefined, undefined")popularRecommendationSearchCriteria.coordinates=popularSearchCriteria.coordinates;var url="/g2mext/api/v1/public/popularSearches";var req={method:"POST",url:url,headers:{"siteCode":userConfig.siteCode,"languageCode":userConfig.selectedLang},data:popularRecommendationSearchCriteria};$http(req).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error fetching lotRecommendationSearch"+
response)})};self.getGlobalPaymentInvoices=function(callback){$http.get("/data/payments/invoices").success(function(response){if(callback)callback(response)}).error(function(response){log.error("Error returned"+response)})};self.submitShippingDetails=function(shippingDetailsVO,callBack){$http.post("/g2mext/public/sell-individual/shipping",shippingDetailsVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getCOEDocumentDetails=
function(lotNumber,callBack){$http.get("/data/coe-details/lot/"+lotNumber).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getInvoiceDocuments=function(invoiceNumber,docType,entity,callback){$http.get("/data/invoice/documents/"+invoiceNumber+"/"+docType+"/"+entity).success(function(response){if(callback)callback(response)}).error(function(response){log.error("Error returned in getInvoiceDocuments"+response)})};self.getGlobalPaymentHistoryInvoices=
function(callback){$http.get("/data/payments/history/invoices").success(function(response){if(callback)callback(response)}).error(function(response){log.error("Error returned"+response)})};self.submitShippingDetails=function(shippingDetailsVO,callBack){$http.post("/g2mext/public/sell-individual/shipping",shippingDetailsVO).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.userLocationInfo=function(callBack,errorCallBack){var req=
{method:"GET",url:"/g2mext/api/v1/public/location-info"};$http(req).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error fetching userLocationInfo"+response);if(errorCallBack)errorCallBack(response)})};self.updateLocationInfo=function(location,callBack){var req={method:"POST",url:"/g2mext/api/v1/public/update-location",data:location};self.g2mExtSecuredCall(req,function(g2mAuthResponse){$http(req).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error updating location"+
response)})})};self.getVinForEpicVinReport=function(lotNumber,callBack){var url="/g2mext/public/lot/epic-vin/"+lotNumber;$http.get(url).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getBuildSheetForLot=function(lotNumber,callBack){var url="/public/data/lot/buildSheet/"+lotNumber;$http.get(url).then(function(response){if(callBack)callBack(response)})};self.getAuthTokenForAutoCheck=function(vin,lotNumber,callBack){var req=
{method:"GET",url:"/g2m/extension/auth/"+vin+"/"+lotNumber};$http(req).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error getting g2m-ext token"+response)})};self.sendEmailRequest=function(memberDetails,callBack){var req={method:"POST",url:"/public/breakerBid4U",data:memberDetails};$http(req).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error updating location"+response)})};self.sendSellerReqForBusiness=
function(sellerDetails,callBack){var req={method:"POST",url:"/public/leads/registerAsBusiness",data:sellerDetails};$http(req).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error updating location"+response)})};self.sendVehicleDeliveryForm=function(VehicleDelivery,callBack){var req={method:"POST",url:"/public/sendVehicleDeliveryForm",data:VehicleDelivery};$http(req).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error updating location"+
response)})};self.g2mExtSecuredCall=function(request,callBack){var url="/public/g2m/extension/auth-headers";$http.get(url).success(function(response){request.data.buyerNumber=userConfig.buyerNumber;request.data.siteCode=userConfig.siteCode;request.headers={"Authorization":response.data};if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+response)})};self.getAuthTokenForAutoCheck=function(vin,lotNumber,callBack){var req={method:"GET",url:"/g2m/extension/auth/"+vin+
"/"+lotNumber};$http(req).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error getting g2m-ext token"+response)})};self.sendEmailRequest=function(memberDetails,callBack){var req={method:"POST",url:"/public/breakerBid4U",data:memberDetails};$http(req).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error updating location"+response)})};self.sendSellerReqForBusiness=function(sellerDetails,callBack){var req=
{method:"POST",url:"/public/leads/registerAsBusiness",data:sellerDetails};$http(req).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error updating location"+response)})};self.g2mExtSecuredCall=function(request,callBack){var url="/public/g2m/extension/auth-headers";$http.get(url).success(function(response){request.data.buyerNumber=userConfig.buyerNumber;request.data.siteCode=userConfig.siteCode;request.headers={"Authorization":response.data};if(callBack)callBack(response)}).error(function(response){log.error("Error returned"+
response)})};self.sendGatePassToTransporter=function(emailGatePassVO,callBack){var req={method:"POST",url:"/data/buyerPickup/emailGatePasses",data:emailGatePassVO};$http(req).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error sending gate passes to transporter"+response)})};self.isOffSiteLot=function(lotNumber,callback){$http.get("/data/buyerPickup/lot/"+lotNumber).success(function(response){if(callback)callback(response)}).error(function(response){log.error("Error returned"+
response)})};self.getOrderAndDeliveryStatus=function(lotNumber,callback){$http.get("/data/order/delivery/status/"+lotNumber).success(function(response){if(callback)callback(response)}).error(function(response){log.error("Error returned"+response)})};self.cancelTransporter=function(lotNumber,callback){$http["delete"]("/data/buyerPickup/cancel/"+lotNumber).success(function(response){if(callback)callback(response)}).error(function(response){log.error("Error returned"+response)})};self.getMemberPickupStatus=
function(lotNumber,callback){$http.get("/data/memberpickup/status/"+lotNumber).success(function(response){if(callback)callback(response)}).error(function(response){log.error("Error returned"+response)})};self.getMakeAnOfferItems=function(callBack){var url="/data/lots/member/offer";$http.get(url).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error getting MakeAnOffer Items"+response)})};self.acceptOffer=function(data,callBack){var req={method:"PUT",
url:"/member/offer/accept",data:data};$http(req).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error getting MakeAnOffer Accept Button"+response)})};self.getOfferForLot=function(lotNumber,buyerNumber,callBack){var req={method:"GET",url:"/member/offer/lot/"+lotNumber+"/"+buyerNumber};$http(req).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error getting g2m-ext token"+response)})};self.getGoLotReport=
function(lotNumber,callBack){var req={method:"GET",url:"/member/go/lot/report/"+lotNumber};$http(req).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error getting g2m-ext token"+response)})};self.removeAwaitingDocApprovalTrafficStop=function(callBack){var data={};var req={method:"POST",url:"/awaitingDocApproval/traffic/stop"};$http(req).then(function(response){if(callBack)callBack(response.data)},function(response){log.error("Error returned"+response)})};
self.getSiteKey=function(callBack){var req={method:"GET",url:"/public/data/reCaptcha/secretKey"};$http(req).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error getting site key"+response)})};self.isKioskUser=function(callback){$http.get("/data/kioskuser").then(function(response){if(callback)callback(response)})};self.getChromeBuildSheetData=function(lotNumber,callBack){var req={method:"GET",url:"/public/data/lot/build-sheet/"+lotNumber};$http(req).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error getting build sheet"+
response)})};self.getConditionReportCharges=function(lotNumber,paymentType,callBack){$http.post("/data/getConditionReportCharges/"+lotNumber+"/"+paymentType).success(function(response){if(callBack)callBack(response)}).error(function(response){log.error("Error returned in fetchConditionReportCharges"+response)})};self.getEnvConfigPropsPromise=function(){var deferred=$q.defer();$http({url:"/public/data/envconfig/properties",method:"GET",noCancelOnRouteChange:true}).then(function(response){deferred.resolve(response.data.data)},
function(error){deferred.reject("error getting envconfig properties");log.error("error getting envconfig properties",error)});return deferred.promise};self.getAccountAlerts=function(callBack){var deferred=$q.defer();$http.get("/data/member/account/alerts").success(function(response){deferred.resolve(response)}).error(function(response){deferred.reject("failed to update user config");log.error("Error fetching account alerts"+response)});return deferred.promise};self.updateAccountAlerts=function(data,
callBack){var deferred=$q.defer();$http.post("/data/member/account/alerts",data).success(function(response){deferred.resolve(response)}).error(function(response){deferred.reject("failed to update user config");log.error("Error fetching account alerts"+response)});return deferred.promise};self.updateDisplayAlertsModal=function(data,callBack){var deferred=$q.defer();$http.post("/public/data/userConfig/account-alerts-modal",data).success(function(response){deferred.resolve(response)}).error(function(response){deferred.reject("failed to update user config");
log.error("Error fetching account alerts"+response)});return deferred.promise};self.getUserActions=function(callBack){var deferred=$q.defer();$http.get("/data/member/user-actions").success(function(response){deferred.resolve(response)}).error(function(response){deferred.reject("failed to update user config");log.error("Error fetching account alerts"+response)});return deferred.promise};self.generatePaymentToken=function(data,callBack){$http.post("/public/payment/token",data).then(function(response){if(callBack)callBack(response.data)},
function(response){if(callBack)callBack({});log.error("Error returned"+response)})};self.membershipPricing=function(callBack){$http.get("/public/data/membership/product-pricing").then(function(response){if(callBack)callBack(response)},function(response){callBack(response);console.log("Pricing not available")})};self.membershipUpgradeApplicableProducts=function(data,callBack){$http.get("/data/membership-upgrade-applicable-products").then(function(response){if(callBack)callBack(response)},function(response){callBack(response);
console.log("Upgrade Products not available")})};self.addCoupon=function(data,callBack){$http.post("/public/payment/apply-coupon",data).then(function(response){if(callBack)callBack(response)},function(response){callBack(response);console.log("Promo application failed")})};self.initiatePayment=function(data,callBack){$http.post("/public/payment/initiate",data).then(function(response){if(callBack)callBack(response)},function(response){if(callBack)callBack({});log.error("Error Payment Initiation"+response)})};
self.submitPayment=function(data,callBack){$http.post("/public/payment/submit",data).then(function(response){if(callBack)callBack(response)},function(response){if(callBack)callBack({});log.error("ErrorPayment Submit"+response)})};self.generateTokenForIntlShipping=function(lotNumber,callback){var url="/public/g2m/extension/auth/intl/"+lotNumber;$http.get(url).then(function(response){if(callback)callback(response)})};self.saveRegistrationStatus=function(data,callBack){$http.post("/public/data/registration/status",
data).then(function(response){if(callBack)callBack(response.data)})};self.getRegistrationStatus=function(refereceId,callBack){var url="/public/data/registration/status";if(refereceId)url=url+"?refId\x3d"+refereceId;$http.get(url).then(function(response){if(callBack)callBack(response.data)})};self.clearRegistrationStatus=function(callBack){$http["delete"]("/public/data/registration/status").then(function(response){if(callBack)callBack(response.data)})};self.updateAccountInfoInRegistration=function(data,
callBack){$http.post("/public/data/member/account",data).then(function(response){if(callBack)callBack(response)},function(response){if(callBack)callBack(response)})};self.getGooglePayEnvConfigProps=function(callBack){var deferred=$q.defer();$http({url:"/public/data/envconfig/googlepay/properties",method:"GET"}).then(function(response){deferred.resolve(response.data)},function(error){log.error("error getting envconfig properties for Google pay",error);deferred.reject(error)});return deferred.promise};
self.getGlobalAlerts=function(callBack){var url="/public/data/global/alerts";$http.get(url).then(function(response){if(callBack)callBack(response)},function(error){if(callBack)callBack(error)})}}]);
app.service("HttpPendingRequestsService",["$q","cfpLoadingBar",function($q,cfpLoadingBar){var cancelPromises=[];function newTimeout(){cfpLoadingBar.start();var cancelPromise=$q.defer();cancelPromises.push(cancelPromise);return cancelPromise.promise}function cancelAll(){cfpLoadingBar.complete();angular.forEach(cancelPromises,function(cancelPromise){cancelPromise.promise.isGloballyCancelled=true;cancelPromise.resolve()});cancelPromises.length=0}return{newTimeout:newTimeout,cancelAll:cancelAll}}]);
app.factory("HttpRequestTimeoutInterceptor",["$q","HttpPendingRequestsService","$sce","$location",function($q,HttpPendingRequestsService,$sce,$location){return{request:function(config){config=config||{};if(config.timeout===undefined&&!config.noCancelOnRouteChange)config.timeout=HttpPendingRequestsService.newTimeout();return config},responseError:function(response){if(response.config&&response.config.timeout&&response.config.timeout.isGloballyCancelled)return $q.defer().promise;return $q.reject(response)}}}]);
app.factory("XSSRequestWrapperInterceptor",["$location",function($location){return{request:function(config){if($location.search()&&!_.isEmpty($location.search())){var search={};_.each($location.search(),function(value,key){if(/<(.|\n)*?>/g.test(value))search[key]=value.replace(/<(.|\n)*?>/g,"");else search[key]=value});$location.search(search)}return config}}}]);
app.service("metaDataService",["$rootScope","$location","dataServiceG2","copartUser","$sce","copartUtils",function($rootScope,$location,dataServiceG2,copartUser,$sce,copartUtils){var self=this;var defaultTitleKey="app.home.title";var defaultDescKey="app.home.description";var metaArgs={};var currentRoute={};var sce=$sce;var seoCountryCodeMap={"USA":"US","CAN":"CA","GBR":"GB","IRL":"IE","ARE":"AE","BHR":"BH","OMN":"OM","DEU":"DE","IND":"IN","ESP":"ES","BRA":"BR","CHN":"CN"};self.getSiteLogoURL=function(locale){var logoPath=
locale.messages["app.logo.ImgPath"];return window.location.origin+logoPath};var seoCountryCodeTitleMap={"CPRTUS":"Copart","CPRTCA":"Copart Canada","CRTSUS":"CrashedToys","DRIVUS":"DRIVE Auto Auctions","CPRTUK":"Copart UK","CPRTMEA":"Copart MEA","CPRTIE":"Copart Ireland","CPRTDE":"Copart Germany","CPRTES":"Copart Spanish","CPRTIN":"Copart India","CPRTFI":"Copart Finland"};self.getSiteTitleFromCountryCode=function(siteCode){return seoCountryCodeTitleMap[siteCode]};self.getEventsSeoObj=function(url){url=
copartUtils.removeTrailingSlash(url);return{"@context":"http://www.schema.org","@type":"Event","name":"","description":"","startDate":[],"endDate":[],"eventStatus":"https://schema.org/EventScheduled","eventAttendanceMode":"https://schema.org/OnlineEventAttendanceMode","location":{"@type":"VirtualLocation","url":url},"image":window.location.origin+"/images/logo.svg"}};self.appendEventToSEO=function(seoObj,script,eventList){if(window.appInit.isUserAgentBOT&&eventList&&seoObj&&script){eventList.forEach(function(auction){seoObj.startDate.push(moment(auction.auctionDate.date).format("MM/DD/YYYY"));
seoObj.endDate.push(moment(auction.auctionDate.date).format("MM/DD/YYYY"))});script.html(JSON.stringify(seoObj))}};self.updateEventSEOAddr=function(seoObj,script,yardDetails,locale){if(window.appInit.isUserAgentBOT&&yardDetails&&script&&seoObj){seoObj.name=yardDetails.yardName;var descVar=" - "+yardDetails.yardName+","+yardDetails.yardMailingStateCode;seoObj.description=sce.getTrustedHtml(locale.getMessage("seo.event.yard.description",descVar));script.html(JSON.stringify(seoObj))}};self.prepareSEOLotDetails=
function(lotDetails,locale){if(!lotDetails||!lotDetails.phynumb)return false;if(lotDetails.ils==true)return false;var siteCode=copartUser.getUserConfig().siteCode;var siteTitle=self.getSiteTitleFromCountryCode(siteCode);var script=$("#seoScript");if(script.length==0){script=$(document.createElement("script"));script.attr("id","seoScript");script.attr("type","application/ld+json");$("body").append(script)}var seoObj=self.getEventsSeoObj($location.absUrl());dataServiceG2.getLocationDetail(lotDetails.phynumb,
function(response){var yardDetails=response.data;if(yardDetails&&script&&seoObj){seoObj.name=yardDetails.yardName;seoObj.description=siteTitle+" - "+yardDetails.yardName+", Upcoming Auto Auction";seoObj.image=self.getSiteLogoURL(locale);if(lotDetails.ifs==false&&lotDetails.ad){seoObj.startDate=moment(lotDetails.ad).tz(copartUser.getUserConfig().selectedTimezone).format("MM/DD/YYYY");seoObj.endDate=moment(lotDetails.ad).tz(copartUser.getUserConfig().selectedTimezone).format("MM/DD/YYYY")}else{script.remove();
return false}script.html(JSON.stringify(seoObj))}})};self.prepareSEOAddrSalesList=function(startTime,saleName,startDate,nextSaleDate,yardNum,isLiveAuction,locale){if(!startTime||!saleName||!startDate||!yardNum)return false;dataServiceG2.getLocationDetail(yardNum,function(response){var locationDetail=response.data;if(locationDetail){if("IRL"==locationDetail.yardCountryCode){locationDetail.yardZip="R14 YK37";locationDetail.yardMailingZip="R14 YK37"}var script=$(document.createElement("script"));script.attr("id",
"seoScript");script.attr("type","application/ld+json");var seoObj=self.getEventsSeoObj($location.absUrl());locationDetail.name=saleName;var startDateTemp="";if(nextSaleDate)startDateTemp=nextSaleDate;else if(isLiveAuction){var currDate=moment().tz(copartUser.getUserConfig().selectedTimezone).format(copartUser.getUserConfig().displayPref.dateFormat.toUpperCase());startDateTemp=currDate}else startDateTemp=startDate;locationDetail.startDate=startDateTemp;self.updateEventSEOAddrSalesList(seoObj,script,
locationDetail,locale);$("body").append(script)}})};self.updateEventSEOAddrSalesList=function(seoObj,script,yardDetails,locale){if(yardDetails&&script&&seoObj){var name=locale.getMessage("app.label.yardDetails.yardName")||"Copart ";seoObj.name=name+yardDetails.name+" Upcoming Auto Auctions";seoObj.description=name+yardDetails.name+" Upcoming Auto Auctions";seoObj.startDate=yardDetails.startDate;seoObj.endDate=yardDetails.startDate;seoObj.location.name=yardDetails.name;seoObj.location.address.streetAddress=
yardDetails.yardAddress1+","+yardDetails.yardAddress2;seoObj.location.address.addressLocality=yardDetails.yardCity;seoObj.location.address.addressRegion=yardDetails.yardStateName;seoObj.location.address.postalCode=yardDetails.yardZip;seoObj.location.address.addressCountry=yardDetails.yardCountryCode;script.html(JSON.stringify(seoObj))}};self.getTitleForRoute=function(route,locale){currentRoute=route;var ret="";try{if(route.titleKey){ret=locale.getMessageForKey(route.titleKey,getArgsValFromMetaArgs(route.arguments?
route.arguments:route.titleArguments),locale.titleDescription);if(!ret||ret==="")ret=locale.messages[defaultTitleKey]}else ret=locale.getMessageForKey(defaultTitleKey)}catch(e){ret=locale.getMessageForKey(defaultTitleKey)}return ret};self.getDescForRoute=function(route,locale){currentRoute=route;var ret="";try{if(route.descKey){ret=locale.getMessageForKey(route.descKey,getArgsValFromMetaArgs(route.arguments?route.arguments:route.descArguments),locale.titleDescription);if(!ret||ret==="")ret=locale.messages[defaultTitleKey]}else ret=
locale.getMessageForKey(defaultDescKey)}catch(e){ret=locale.getMessageForKey(defaultDescKey)}return ret};self.refresh=function(locale){$rootScope.title=self.getTitleForRoute(currentRoute,locale);$rootScope.description=self.getDescForRoute(currentRoute,locale)};self.setPreviousPage=function(url){$rootScope.previousPage=url};self.setNextPage=function(url){$rootScope.nextPage=url};self.clearPageTags=function(){$rootScope.previousPage=null;$rootScope.nextPage=null};var metaDataUpdateEvent=$rootScope.$on("meta-args-update",
function(event,data){var keys=_.keys(data);for(var i=0;i<keys.length;i++)metaArgs[keys[i]]=data[keys[i]];$rootScope.$emit("update-site-meta")});var getArgsValFromMetaArgs=function(args){var ret=[];if(args){for(var i=0;i<args.length;i++)ret.push(metaArgs[args[i]]);return ret}else return ret};self.prepareEventMarkupSeoObj=function(totalItemsOnSale,startDate){return{"@context":"http://schema.org","@type":"Corporation","name":"Copart","description":"Leader in online salvage \x26 insurance auto auctions \x26 sales. Over 130,000 total loss cars, clean title, used cars, trucks, SUVs \x26 fleet vehicles.",
"url":"https://www.copart.com/","logo":"https://www.copart.com/images/logo.svg","address":{"streetAddress":"14185 Dallas Parkway, Suite 300","addressLocality":"Dallas","addressRegion":"TX","postalCode":"75254","addressCountry":"USA"},"telephone":"(972) 391-5000","sameAs":["https://www.facebook.com/Copart","https://twitter.com/copart","https://plus.google.com/+CopartTV","https://www.instagram.com/copart1982/","https://www.youtube.com/copart","https://www.linkedin.com/company/copart","https://en.wikipedia.org/wiki/Copart"],
"telephone":""}};self.prepareEventMarkupSeoScriptObj=function(totalItemsOnSale,url,startDate){url=copartUtils.removeTrailingSlash(url);return{"@context":"http://schema.org","@type":"Event","name":"Over "+totalItemsOnSale+" Vehicles on sale now!","url":url,"startDate":startDate,"endDate":startDate,"Location":{"@type":"Place","address":url}}};self.callPrepareEventMarkupSeoObj=function(){setTimeout(function(){var startDate=moment().tz(copartUser.getUserConfig().selectedTimezone).format(copartUser.getUserConfig().defaultDisplayPref.dateFormat.toUpperCase());
var markupSeoObj=self.prepareEventMarkupSeoObj(dataServiceG2.totalItemsOnSale,startDate);var script=$(document.createElement("script"));script.attr("type","application/ld+json");script.html(JSON.stringify(markupSeoObj));$("body").append(script)},1E3)};self.callPrepareEventMarkupSeoScriptObj=function(){setTimeout(function(){var startDate=moment().tz(copartUser.getUserConfig().selectedTimezone).format(copartUser.getUserConfig().defaultDisplayPref.dateFormat.toUpperCase());var markupSeoObj=self.prepareEventMarkupSeoScriptObj(dataServiceG2.totalItemsOnSale,
window.location.href,startDate);var script=$(document.createElement("script"));script.attr("type","application/ld+json");script.html(JSON.stringify(markupSeoObj));$("body").append(script)},1E3)}}]);
app.service("geocodingService",["userService","dataServiceG2",function(userService,dataServiceG2){var self=this;self.zipToCoord={};var userConfig=userService.userConfig;self.threeCharCountryCode=userConfig.preferredCountryCode?userConfig.preferredCountryCode.toUpperCase():"";self.getCoordinatesForZip=function(zip,callback){if(_.isEmpty(self.zipToCoord))self.zipToCoord=userService.userConfig.zipToCoordinate||{};var retData={latitude:0,longitude:0};if(!_.isEmpty(self.zipToCoord[zip])){retData.latitude=
self.zipToCoord[zip].latitude;retData.longitude=self.zipToCoord[zip].longitude;if(callback)callback(retData)}else getCoordinatesFromLocationInfoService(zip,retData,callback)};var getCoordinatesFromLocationInfoService=function(zip,retData,callback){var zipCode=zip?zip.trim():"";var location={"threeCharCountryCode":self.threeCharCountryCode,"zipCode":zipCode};if(location.threeCharCountryCode==="CAN"||location.threeCharCountryCode==="IRL")location.zipCode=zipCode.slice(0,3);dataServiceG2.updateLocationInfo(location,
function(response){if(_.isEmpty(response.data)){retData.status=-1;return}if(response.returnCode!=-1&&!_.isEmpty(response.data)){if(response.data.length>0){retData.latitude=response.data[0].latitude;retData.longitude=response.data[0].longitude;self.zipToCoord[zip]={latitude:retData.latitude,longitude:retData.longitude};var zipToCoordinate={};zipToCoordinate[zip]=retData;dataServiceG2.updateUserConfig({"zipToCoordinate":zipToCoordinate})}if(callback)callback(retData)}},function(error){console.log.error("Failed to fetch Location coordinates"+
error);if(callback)callback(retData)})}}]);"use strict";
app.service("userService",["copartUser",function(copartUser){var self=this;self.userConfig=copartUser.config;self.bidIncrements=[];var pagesWithPreBid=["/saleListResult","/watchList","/saleListResultAll"];var pagesWithShowAll=["saleListResult"];self.isAnonymous=function(){if(_.contains(self.userConfig.roles,"ROLE_ANONYMOUS"))return true;else return false};self.isPremium=function(){if(_.contains(self.userConfig.roles,"ROLE_PREMIUM"))return true;else return false};self.isInActive=function(){if(self.userConfig.buyerStatus==
"I")return true;else return false};self.isBroker=function(){if(_.contains(self.userConfig.roles,"ROLE_BROKER"))return true;else return false};self.isMaster=function(){if(_.contains(self.userConfig.roles,"ROLE_MASTER"))return true;else return false};self.isEligibleToMultiBid=function(url){for(var i=0;i<pagesWithPreBid.length;i++){var item=pagesWithPreBid[i];if(url.indexOf(item)!=-1)return copartUser.hasAccessPrivilege("MULTI_LOT_BIDDING")}return false};self.isShowAllEnabled=function(url){for(var i=
0;i<pagesWithShowAll.length;i++){var item=pagesWithShowAll[i];if(url.indexOf(item)!=-1)if(copartUser.getUserConfig().isKioskBidder&&item=="saleListResult")return false;else return true}return false};self.getBuyerNumber=function(){if(!_.isUndefined(self.userConfig.buyerNumber))return self.userConfig.buyerNumber;else return"1"}}]);
app.service("googleAdService",function(){var self=this;self.getGoogleAdObject=function(adPageName,adNumber,userService){var googleAdPrefMap=userService.userConfig.displayPref[adPageName];if(!adNumber||!googleAdPrefMap)return;return googleAdPrefMap[adNumber]?googleAdPrefMap[adNumber]:null}});
app.service("bidService",["copartUser","appConfigService","$locale",function(copartUser,appConfigService,$locale){var self=this;self.bidIncrements=[];self.locale=null;self.setLocale=function(locale){self.locale=locale};self.getBidIncrements=function(){var appConfig=appConfigService.getAppConfig();if(self.bidIncrements.length==0){self.bidIncrements=_.where(appConfig.getBidIncrements(),{bidType:"P"});self.bidIncrements=_.sortBy(self.bidIncrements,"highPrice");return self.bidIncrements}else return self.bidIncrements};
self.getBidIncrement=function(price){if(self.bidIncrements.length==0)self.getBidIncrements();var prices=_.pluck(self.bidIncrements,"highPrice");for(var i in prices)if(parseInt(price)<parseInt(prices[i]))return parseInt(self.bidIncrements[i].bidInc);return parseInt(self.bidIncrements[self.bidIncrements.length-1].bidInc)};self.checkBidValue=function(price,bidIncrement,currentBid){price=parseInt(price);var bidInc=bidIncrement;var bidErrorMsg="";if(price%bidInc!=0){var lowerBound=self.decrementValue(price,
bidInc,currentBid);var upperBound=self.incrementValue(price,bidInc,currentBid);bidErrorMsg=self.locale.getMessage("lotdetail.error.bid.notIn.increments",lowerBound,upperBound);return bidErrorMsg}else return bidErrorMsg};self.incrementValue=function(bidValue,incrementValue,currentBid){bidValue=parseInt(bidValue);incrementValue=parseInt(incrementValue);currentBid=parseInt(currentBid);var baseValue=currentBid+incrementValue;if((bidValue+incrementValue)%incrementValue==0)return bidValue+incrementValue<=
9999999?bidValue+incrementValue<baseValue?baseValue:bidValue+incrementValue:9999999;var incrementFactor=Math.abs(incrementValue-bidValue%incrementValue);return bidValue+incrementFactor<=9999999?bidValue+incrementFactor<baseValue?baseValue:bidValue+incrementFactor:9999999};self.decrementValue=function(bidValue,decrementValue,currentBid){bidValue=parseInt(bidValue);decrementValue=parseInt(decrementValue);currentBid=parseInt(currentBid);var baseValue=currentBid+decrementValue;if((bidValue-decrementValue)%
decrementValue==0)return bidValue-decrementValue>baseValue?bidValue-decrementValue:baseValue;var decrementFactor=Math.abs(decrementValue-bidValue%decrementValue);return bidValue-decrementValue+decrementFactor>baseValue?bidValue-decrementValue+decrementFactor:baseValue};self.getBidErrorMessage=function(errorObj){if(!errorObj)return;var errorCode=errorObj.errorCode?errorObj.errorCode.trim():"";if(self.locale.messages["lotdetail.error.code."+errorCode])return self.locale.getMessage("lotdetail.error.code."+
errorCode,errorObj.outLowerBid,errorObj.outHigherBid);else return errorObj.errorMessage}}]);app.factory("watchListCache",["$cacheFactory",function($cacheFactory){return $cacheFactory("watchlist-cache")}]);
app.service("watchListService",["userService","appConfigService","$http","dataServiceG2","functionQueueService","siteCatalyst",function(userService,appConfigService,$http,dataServiceG2,functionQueueService,siteCatalyst){var self=this;var watchList=[];var isWatchList=false;var log=new Logger({name:"watchListService"});self.addToWatchListForCompare=function(lotNumber){var item={};item.lotId=lotNumber;watchList.push(item);callsiteCatalyst("add",lotNumber)};self.removeFromWatchListForCompare=function(lotNumber){var index=
_.findIndex(watchList,function(lot){return lot.lotId==lotNumber});if(index!=-1)watchList.splice(index,1);callsiteCatalyst("remove",lotNumber)};self.setWatchListDefinition=function(url){if(url.indexOf("/watchList")!=-1)isWatchList=true;else isWatchList=false;if(!userService.isAnonymous())self.getWatchListForBuyer()};self.isWatchList=function(){return isWatchList};var refreshWatchListData=function(callBack){dataServiceG2.getWatchListForBuyer(function(response){if(_.isUndefined(watchList))watchList=
response.data.data.watchList;else watchList=_.union(watchList,response.data.data.watchList);if(callBack)callBack(response)})};var forceRefreshWatchListData=function(){dataServiceG2.getWatchListForBuyer(function(response){watchList=response.data.data.watchList})};self.getWatchListForBuyer=function(){if(_.isUndefined(watchList)||watchList.length==0)dataServiceG2.getWatchListForBuyer(function(response){if(_.isUndefined(watchList))watchList=response.data.data.watchList;else watchList=_.union(watchList,
response.data.data.watchList)})};self.isAlreadyAdded=function(lotNumber){var object=_.find(watchList,function(item){return item.lotId==lotNumber});if(object)return true;else return false};self.addToWatchList=function(lotNumber,callBack){if(!userService.isAnonymous()){dataServiceG2.addToWatchList(lotNumber,function(response){if(response.data.returnCode==1){var item={};item.lotId=lotNumber;watchList.push(item);if(callBack)callBack(response)}else if(response.data.data&&response.data.data.code&&response.data.data.message){alert(response.data.data.message);
log.error("Failed to add lot in watch list--"+response.data.data.code)}});callsiteCatalyst("add",lotNumber)}else localStorage.setItem("addtoWatchlistLotId",JSON.stringify({lotId:lotNumber,timestamp:(new Date).getTime()+18E4}))};self.addtoWatchlistAssumingLoggedInUser=function(lotNumber){dataServiceG2.addToWatchList(lotNumber,function(response){if(response.data.returnCode==1){var item={};item.lotId=lotNumber;watchList.push(item)}else log.error("Failed to add lot in watch list")})};self.removeFromWatchList=
function(lotNumber,callBack){if(!userService.isAnonymous()){dataServiceG2.removeFromWatchList(lotNumber,function(response){if(response.data.returnCode==1){var index=_.findIndex(watchList,function(lot){return lot.lotId==lotNumber});if(index!=-1)watchList.splice(index,1);if(callBack)callBack(response)}else log.error("Failed to removed lot from watch list")});callsiteCatalyst("remove",lotNumber)}};self.addAllCheckedToWatchList=function(selectedLots,callBack,errorCallBack){dataServiceG2.addAllCheckedToWatchlist(_.pluck(selectedLots,
"lotId"),function(response){if(response.data.returnCode!=-1){watchList=_.union(watchList,selectedLots);if(callBack)callBack(response)}else errorCallBack(response)})};self.addAllToWatchList=function(data,callBack,errorCallBack,syncCallBack){dataServiceG2.addAllToWatchlist(data,function(response){if(response.data.returnCode!=-1){refreshWatchListData(syncCallBack);if(callBack)callBack(response)}else errorCallBack(response)})};self.removeAllFromWatchlist=function(data,callBack){dataServiceG2.removeAllFromWatchlist(data,
function(response){if(response.data.returnCode!=-1)forceRefreshWatchListData();if(callBack)callBack(response)})};self.removeCheckedFromWatchlist=function(selectedLots,callBack){dataServiceG2.removeCheckedFromWatchlist(_.pluck(selectedLots,"lotId"),function(response){if(response.data.returnCode!=-1){watchList=_.filter(watchList,function(item){return _.isUndefined(_.findWhere(selectedLots,{lotId:item.lotId.toString()}))});if(callBack)callBack(response)}});for(var i in selectedLots)if(!AppUtils.isUndefined(selectedLots)&&
!AppUtils.isUndefined(selectedLots[i].lotId))callsiteCatalyst("remove",selectedLots[i].lotId)};var callsiteCatalyst=function(addremove,lotNumber){var siteCatalystVal={};siteCatalystVal.fname="doTagWatchList";siteCatalystVal.addremove=addremove;siteCatalystVal.lotId=lotNumber;siteCatalyst.addToQueue("doTagWatchList",siteCatalystVal);siteCatalyst.executeCall("doTagWatchList")};window.getWatchListLots=function(){return watchList}}]);
app.service("auctionsCalendarService",["dataServiceG2","$q","$interval","copartUser",function(dataServiceG2,$q,$interval,copartUser){var self=this;self.todaysAuctionDate=moment();self.globalPromise=null;self.getAuctionsCalender=function(refresh){var deferred;if(refresh){self.globalPromise=null;deferred=$q.defer()}else{if(self.globalPromise)return self.globalPromise;deferred=$q.defer();if(!_.isEmpty(self.allList)){deferred.resolve();return deferred.promise}}dataServiceG2.getAuctionsCalendarList(function(response){self.todayAuctions=
{liveAuctions:[],endedAuctions:[],laterAuctions:[]};self.futureAuctions=[];if(response.returnCode==1&&response.returnCodeDesc=="Success"){self.todaysAuctionDate=moment.utc(response.data.todaysAuctionDate);self.offset=copartUser.getUserTimzoneOffset();self.todayDate=self.todaysAuctionDate.utcOffset(self.offset).format("YYYYMMDD");if(moment.utc(response.data.todaysAuctionDate).startOf("isoWeek").toDate().getDay()==0)self.startDayofWeek=moment.utc(response.data.todaysAuctionDate).startOf("isoWeek").utcOffset(self.offset).add(1,
"days");else self.startDayofWeek=moment.utc(response.data.todaysAuctionDate).startOf("isoWeek").utcOffset(self.offset);self.allList=response.data.saleList;self.reGroupAuctions();deferred.resolve()}else deferred.reject();self.globalPromise=null});self.globalPromise=deferred.promise;return self.globalPromise};self.reGroupAuctions=function(){self.todayAuctions={liveAuctions:[],endedAuctions:[],laterAuctions:[]};_.each(self.allList,function(auction){if(auction.auctionDate!=null)if(auction.auctionDate.dateAsInt==
self.todayDate)if(auction.isLive)self.todayAuctions.liveAuctions.push(auction);else if(auction.closedFlag=="Y")self.todayAuctions.endedAuctions.push(auction);else{if(auction.closedFlag=="N"||auction.closedFlag==""||auction.closedFlag=="E")self.todayAuctions.laterAuctions.push(auction)}else if(auction.auctionDate.dateAsInt>self.todayDate)self.futureAuctions.push(auction)})};function refereshAuctionCalendar(){self.allList=[]}$interval(refereshAuctionCalendar,18E4);self.getAllList=function(){var deferred=
$q.defer();self.getAuctionsCalender(false).then(function(){deferred.resolve()});return deferred.promise};self.getAllAuctionData=function(){var deferred=$q.defer();self.getAuctionsCalender(false).then(function(){var data={};data.allList=self.allList;data.todayAuctions=self.todayAuctions;deferred.resolve(data)});return deferred.promise};self.todayAuctionsByYard=function(yardNumber){var deferred=$q.defer();self.getAllList().then(function(){var auction=_.filter(self.allList,function(list){var yardList=
_.filter(list.yards,function(yard){return yard.number==yardNumber&&list.auctionDate.dateAsInt==self.todayDate});return yardList.length>0});deferred.resolve(auction)});return deferred.promise};self.laterAuctionsByYard=function(yardNumber){var deferred=$q.defer();self.getAllList().then(function(){var auction=_.filter(self.allList,function(list){var yardList=_.filter(list.yards,function(yard){return yard.number==yardNumber&&list.auctionDate.dateAsInt>self.todayDate});return yardList.length>0});auction.sort(function(a,
b){var auction1=parseInt(a["auctionDate"]&&a["auctionDate"].dateAsInt?a["auctionDate"].dateAsInt:0);var auction2=parseInt(b["auctionDate"]&&b["auctionDate"].dateAsInt?b["auctionDate"].dateAsInt:0);if(auction1===auction2){auction1=parseInt(a["fullTime"]?a["fullTime"]:0);auction2=parseInt(b["fullTime"]?b["fullTime"]:0)}return auction1-auction2});deferred.resolve(auction)});return deferred.promise};self.auctionByYard=function(yardNumber){var deferred=$q.defer();self.getAllList().then(function(){var futureYardList=
_.filter(self.allList,function(auction){var UnixAuctionDate=new Date(auction.auctionDate.date);var month=UnixAuctionDate.getMonth()+1>9?UnixAuctionDate.getMonth()+1:"0"+UnixAuctionDate.getMonth()+1;var date=UnixAuctionDate.getDate()>9?UnixAuctionDate.getDate():"0"+UnixAuctionDate.getDate();var yardAuctionDate=""+UnixAuctionDate.getFullYear()+month+date;return Number(yardAuctionDate)>=Number(self.todayDate)});var auction=_.find(_.sortBy(futureYardList,function(auctionYard){return auctionYard.auctionDate.dateAsInt}),
function(item){return item.closedFlag!="Y"&&item.yardNumber==yardNumber});deferred.resolve(auction)});return deferred.promise};self.timeToAuction=function(auctionDate){if(!auctionDate)return null;var now=Date.now();var diff=(auctionDate-now)/1E3;if(diff<0)return null;var mins=Math.floor(diff/60%60);var hours=Math.floor(diff/60/60%24);var days=Math.floor(diff/60/60/24);return days+"D "+hours+"H "+mins+"min"};self.getLanesListForLiveYard=function(yardNumber){var deferred=$q.defer();self.getAllList().then(function(){var laneInfoList=
{};if(self.todayAuctions.liveAuctions.length>0)_.each(self.todayAuctions.liveAuctions,function(list){_.each(list.yards,function(yard){if(yard.number==yardNumber)laneInfoList[list.saleName]=list.laneInfoList})});deferred.resolve(laneInfoList)});return deferred.promise};self.isYardLive=function(yardNumber){var deferred=$q.defer();self.getAllList().then(function(){var flag=false;if(self.todayAuctions.liveAuctions.length>0)_.each(self.todayAuctions.liveAuctions,function(auction){if(auction.yardNumber==
yardNumber)flag=true});deferred.resolve(flag)});return deferred.promise};self.isAuctionLive=function(yardNumber,lane,auctionDate,auctionId){var deferred=$q.defer();var flag=false;self.getAllList().then(function(){if(self.todayAuctions.liveAuctions.length>0)_.find(self.todayAuctions.liveAuctions,function(auction){if(auctionId&&auction.auctionId&&auctionId===auction.auctionId||auction.yardNumber==yardNumber&&moment.utc(auctionDate).isSame(moment.utc(auction.currentSaleTimeEpoch),"day")){_.find(auction.laneInfoList,
function(laneInfo){if(laneInfo.lane==lane&&laneInfo.closedFlag=="I"){flag=true;return flag}});return flag}});deferred.resolve(flag)});return deferred.promise};self.getAuctionDetails=function(auctionId,yardNumber,epochDateTime){var deferred=$q.defer();self.getAllList().then(function(){var auction=auctionId?_.find(self.allList,function(item){return item.auctionId==auctionId}):_.find(self.allList,function(item){return epochDateTime?item.yardNumber==yardNumber&&moment.utc(epochDateTime).isSame(moment.utc(item.currentSaleTimeEpoch),
"day"):item.yardNumber==yardNumber});deferred.resolve(auction)});return deferred.promise};self.getLotAuctionStatus=function(solrLots){var deferred=$q.defer();self.getAllList().then(function(){var data={"returnCode":2,"returnCodeDesc":"Success","data":{}};var lots={};_.each(solrLots,function(solrLot){var flag=false;var lot={};lot.lotNum=solrLot.ln;if(self.todayAuctions.liveAuctions.length>0){var liveAuctionForYard=_.find(self.todayAuctions.liveAuctions,function(auction){if(solrLot.adt!="E"&&auction.yardNumber==
solrLot.ynumb&&moment.utc(solrLot.ad).isSame(moment.utc(auction.currentSaleTimeEpoch),"day")){flag=true;return auction}});lot.lotAuctionStatus=flag==true?"LIVE_BIDDING":"";lot.las=flag==true?"LIVE_BIDDING":""}else{lot.lotAuctionStatus="";lot.las=""}lots[solrLot.ln]=lot});data.data=lots;deferred.resolve(data)});return deferred.promise}}]);
app.service("auctionsCalendarStoreService",["$q","$interval",function(dataServiceG2,$q,$interval){var self=this;var allList=[];self.auctionByYard=function(yardNumber){var deferred=$q.defer();self.getAllList().then(function(){var auction=_.find(allList,function(item){return item.yardNumber==yardNumber});deferred.resolve(auction)});return deferred.promise};self.setAllList=function(list){allList=list}}]);
app.service("cmsContentService",["$http","$q","userService","copartUser","$rootScope","urlService",function($http,$q,userService,copartUser,$rootScope,urlService){var log=new Logger({name:"cmsContentService"});var self=this;var cmsContentMap={};var cmsContentPromises={};self.getFragmentContent=function(fragmentUri){if(cmsContentPromises[fragmentUri])return cmsContentPromises[fragmentUri];var deferred=$q.defer();if(_.isUndefined(cmsContentMap[fragmentUri])){cmsContentPromises[fragmentUri]=deferred.promise;
var req={method:"GET",url:self.getCmsContentUrl(fragmentUri)};$http(req).then(function(response){var result=cmsContentMap[fragmentUri]=response.data;deferred.resolve(result);delete cmsContentPromises[fragmentUri]},function errorCallback(response){log.error("Error connecting fetching content",response);deferred.reject("")})}else deferred.resolve(cmsContentMap[fragmentUri]);return deferred.promise};self.setParentFragment=function(parentFragment){if(cmsContentPromises[parentFragment])return cmsContentPromises[parentFragment];
var deferred=$q.defer();if(_.isUndefined(cmsContentMap[parentFragment])){cmsContentPromises[parentFragment]=deferred.promise;var req={method:"GET",url:self.getCmsContentUrl(parentFragment)};$http(req).then(function(response){cmsContentMap[parentFragment]=response.data;delete cmsContentPromises[parentFragment];deferred.resolve(true)},function errorCallback(response){deferred.reject(false)})}else deferred.resolve(true);return deferred.promise};self.getContentUrl=function(fragmentId){var site=userService.userConfig.siteCode;
var finalUrl=self.constructUrl(fragmentId);finalUrl=copartUser.getLocationUrlWithLocale(finalUrl);if(site==="DRIVUS")finalUrl=finalUrl.toLowerCase();return finalUrl};self.getCmsContentUrl=function(fragmentId){var lang=appInit.localeString;return"/CMS/"+lang+self.constructUrl(fragmentId)};self.constructUrl=function(fragmentId){var region=appInit.regionCode;var lang=appInit.localeString;var path=self.getFormattedUrl(fragmentId);var finalUrl="/Content/"+region+"/"+lang+"/"+path;return finalUrl};self.getFormattedUrl=
function(url){if(url.charAt(0)==="."&&url.charAt(1)==="/"){var splitArray=url.split("/");splitArray.splice(0,1);url=splitArray.join("/")}var splitArray=url.split("/");if(splitArray[0]===""){splitArray.splice(0,1);url=splitArray.join("/")}if(splitArray[0].toLowerCase()==="content"){var splitArray1=url.split("/");splitArray1.splice(0,3);url=splitArray1.join("/")}if(splitArray[0]==="CMS"){var splitArray1=url.split("/");splitArray1.splice(0,4);url=splitArray1.join("/")}return url};self.setCanonicalHref=
function(url){$rootScope.canonicalHref=url};self.createCanonicalHref=function(url){var sitDomainUrl=urlService.getSiteUrlFromLocation();return sitDomainUrl+copartUser.getLocationUrlWithLocale(url)}}]);"use strict";
app.service("accountInfoDataService",["$q","dataServiceG2","$window",function($q,dataServiceG2,$window){var self=this;var creditCards={};var refundBalance=null;var showHideDepositBalance="UnInitialized";self.getRefundBalance=function(){return refundBalance};self.setRefundBalance=function(newValue){refundBalance=newValue};self.getDepositRefundDetails=function(){var deferred=$q.defer();if(showHideDepositBalance==="UnInitialized")dataServiceG2.getCreditCardDetailsForDepositRefund().then(function(response){var successCode=
response.data.returnCodeDesc;if(successCode==="Success"){creditCards=response.data.data.depositRefundCardDetails;self.getDepositRefundBalance().then(function(showHideDepositBalance){deferred.resolve(showHideDepositBalance)})}});else deferred.resolve(showHideDepositBalance);return deferred.promise};self.getDepositRefundBalance=function(){var deferred=$q.defer();dataServiceG2.getDepositRefundBalance().then(function(response){var successCode=response.data.returnCodeDesc;if(successCode==="Success"){refundBalance=
response.data.data.depositRefundBalance;if(refundBalance&&refundBalance.depositBalance!==undefined&&refundBalance.depositBalance!=null&&refundBalance.depositBalance>0)showHideDepositBalance="show";else showHideDepositBalance="hide";deferred.resolve(showHideDepositBalance)}});return deferred.promise};self.getCreditCardDetailsForDepositRefund=function(){var deferred=$q.defer();if(creditCards&&creditCards.length>0)deferred.resolve(creditCards);else dataServiceG2.getCreditCardDetailsForDepositRefund().then(function(response){var successCode=
response.data.returnCodeDesc;if(successCode==="Success"){creditCards=response.data.data.depositRefundCardDetails;deferred.resolve(creditCards)}else deferred.reject()});return deferred.promise};self.getRefundBalanceAmount=function(){var deferred=$q.defer();if(refundBalance&&refundBalance.depositBalance!==undefined&&refundBalance.depositBalance!=null&&refundBalance.depositBalance>0)deferred.resolve(refundBalance);else dataServiceG2.getDepositRefundBalance().then(function(response){var successCode=response.data.returnCodeDesc;
if(successCode==="Success"){refundBalance=response.data.data.depositRefundBalance;deferred.resolve(refundBalance)}else deferred.reject()});return deferred.promise};self.getShowHideDepositBalance=function(){return showHideDepositBalance};self.setShowHideDepositBalanceFlag=function(newVal){showHideDepositBalance=newVal};self.renewalFees=function(){var requestParam={};requestParam.GATEWAY_URL_KEY="RENEWAL_FEES";requestParam.cancelCallBackUrl="/logout";requestParam.successCallBackURL="dashboard";dataServiceG2.setPciParam(requestParam,
function(response){if(response.returnCode==1)$window.location.href=response.data.pciURL.trim();else log.error("Error in Gateway")})}}]);
app.service("paymentService",["$location","dataServiceG2","$q","localStorageService","urlService","saveLotNumbersService","singleSignOnService","copartUser",function($location,dataServiceG2,$q,localStorageService,urlService,saveLotNumbersService,singleSignOnService,copartUser){var self=this;self.paymentInfo={};self.memberPickupRolloutVO=copartUser.getUserConfig().defaultDisplayPref.memberPickupRolloutVO||{};self.hasItRolledOutToAllYards=self.memberPickupRolloutVO.hasItRolledOutToAllYards;self.memberPickupRolloutStates=
self.memberPickupRolloutVO.states||[];self.memberPickupRolloutYards=self.memberPickupRolloutVO.yards||[];self.upgradeMembershipFlag=false;var log=new Logger({name:"paymentService"});var storeNavigationInfo=function(resultIndex,lotNumber){var info={backTo:"."+$location.url(),resultIndex:resultIndex};localStorageService.set("lot-navigation-info",info);localStorageService.set("restore-search-state",true)};self.checkYardBySiteCode=function(yardNumber){var deferred=$q.defer();var requestParam={};requestParam.yardNumber=
yardNumber;dataServiceG2.checkYardBySiteCode(requestParam,function(result){if(result.returnCode==1)if(result.data.yardExist)deferred.resolve();else deferred.reject();else deferred.reject()});return deferred.promise};self.showYardNotExistModal=function(){$("#yardNotExistMessage").modal("show")};self.navigateToLotDetails=function(yardNumber,lotNumber,brand,$event){var resultIndex=saveLotNumbersService.getResultIndex(lotNumber);var lotUrl="/lot/"+lotNumber;if($event&&$event.target.hasAttribute("viewPhotos"))lotUrl+=
"/Photos";if(singleSignOnService.isEligibleForSingleSignOn(brand)){if($event){$event.target.setAttribute("href",singleSignOnService.getSingleSignOnUrl(lotUrl,brand));$event.target.setAttribute("target","_blank")}}else{var successCallBack=function(){storeNavigationInfo(resultIndex,lotNumber);$location.url(lotUrl)};self.checkYardExist(yardNumber,successCallBack)}};self.navigateToLocationDetails=function(yardNumber){var successCallBack=function(){var url=urlService.getLocationUrl(yardNumber);$location.url(url)};
self.checkYardExist(yardNumber,successCallBack)};self.checkYardExist=function(yardNumber,successCallBack,errorCallBack){self.checkYardBySiteCode(yardNumber).then(function(){if(successCallBack)successCallBack()},function(){if(errorCallBack)errorCallBack();else self.showYardNotExistModal()})};self.storePaymentInfo=function(data){self.paymentInfo=data};self.getPaymentInfo=function(){return self.paymentInfo};self.setUpgradeMembershipFlag=function(flag){localStorageService.set("upgradeMembershipFlag",
flag)};self.getUpgradeMembershipFlag=function(){var upgradeMembershipFlag=localStorageService.get("upgradeMembershipFlag");return upgradeMembershipFlag?true:false};self.removeUpgradeMembershipFlag=function(){localStorageService.remove("upgradeMembershipFlag")};self.buyerPickupStatusArr=["TBS","SCH","CNF"];self.buildMemberPickUpStatus=function(row,yardName,lotId){var html="";if(self.isShowmemberPickUpStatus(row,yardName)){var displayStatusLink="send";var cancelTransporterLink="";var isMiscellaneousInvoice=
false;var buyerPickupStatus=row["buyerPickupStatus"]||"";var lotNumber=lotId&&lotId>0?lotId:null;if(_.contains(self.buyerPickupStatusArr,buyerPickupStatus)){displayStatusLink="edit";cancelTransporterLink="cancel"}var hideLinkStatus=buyerPickupStatus=="CMPTD"||buyerPickupStatus=="ARVD"?true:false;var existingTransporterEmail=row["transporterEmail"]&&row["transporterEmail"].trim()!=""?row["transporterEmail"].trim():"";if(!_.isEmpty(row["description"])&&row["description"].toLowerCase()==="MISCELLANEOUS CHARGE".toLowerCase()||
!_.isEmpty(row["lori"])&&row["lori"].trim()=="INVOICE")isMiscellaneousInvoice=true;var sendGatePassLink="\x3cspan ng-if\x3d"+!hideLinkStatus+"\x3e\x3ca ng-if\x3d"+!isMiscellaneousInvoice+' ng-click\x3d"openEmailGatePassToTransporterModal('+lotNumber+",'"+existingTransporterEmail+"'"+')" data-toggle\x3d"modal"\x3e {{locale.messages["app.label.buyerpickStatus.'+displayStatusLink+'"]}}\x3c/a\x3e'+"\x3cspan ng-if\x3d"+(displayStatusLink=="edit")+'\x3e\x3cbr/\x3e\x3ca ng-click\x3d"openCancelTransporterModal('+
lotNumber+",'"+existingTransporterEmail+"'"+')" data-toggle\x3d"modal"\x3e {{locale.messages["app.label.buyerpickStatus.'+cancelTransporterLink+'"]}}\x3c/a\x3e'+"\x3c/span\x3e\x3c/span\x3e";if(buyerPickupStatus!="UNKNOWN")html="\x3cspan\x3e\x3ca ng-if\x3d"+lotNumber+' ng-click\x3d"openBuyerPickupStatusDetailsModal('+lotNumber+')" data-toggle\x3d"modal"\x3e {{locale.messages["app.label.buyerpickup.status.'+buyerPickupStatus+'"]}} \x3c/a\x3e\x3c/span\x3e'+"\x3cbr/\x3e"+sendGatePassLink;else html=sendGatePassLink}return html};
self.isShowmemberPickUpStatus=function(row,yardName){return self.hasItRolledOutToAllYards||self.containsAny(yardName,self.memberPickupRolloutStates)||_.contains(self.memberPickupRolloutYards,String(row["yn"]))};self.containsAny=function(str,substrings){if(!_.isEmpty(substrings)){for(var i=0;i!=substrings.length;i++){var substring=substrings[i];if(str.indexOf(substring)!=-1)return true}return false}else return false};self.getOffSiteLot=function(lotNumber){var deferred=$q.defer();dataServiceG2.isOffSiteLot(lotNumber,
function(response){var isOffSiteLot=false;if(response.returnCode!=-1&&!_.isUndefined(response.data))isOffSiteLot=response.data;else log.error("send to Transporter Call -\x3e Failed "+response);deferred.resolve(isOffSiteLot)});return deferred.promise};self.getOrderAndDeliveryStatus=function(lotNumber){var deferred=$q.defer();dataServiceG2.getOrderAndDeliveryStatus(lotNumber,function(response){var orderStatus=null;if(response.returnCode!=-1&&!_.isUndefined(response.data))orderStatus=response.data;else log.error("get order status Call -\x3e Failed "+
response);deferred.resolve(orderStatus)});return deferred.promise}}]);"use strict";
app.service("lotDetailsService",["$rootScope","$routeParams","$route","dataServiceG2","$q","watchListService","$location","trimFilter","copartUser","userService","appConfigService",function($rootScope,$routeParams,$route,dataServiceG2,$q,watchListService,$location,trimFilter,copartUser,userService,appConfigService){var log=new Logger({name:"lotDetailsService"});var self=this;var appConfig=appConfigService.getAppConfig();var userConfig=userService.userConfig;var getFormattedSaleDate=function(staticLotDetails){var saleDateFormat=
userService.userConfig.lotDetailsPreference.saleDateFormat;var formattedSaleDate=moment.utc(staticLotDetails.ad).tz(userService.userConfig.selectedTimezone).format(saleDateFormat);return formattedSaleDate};self.verifyAndGetLotIfExists=function(staticLotDetailsPromise){if(staticLotDetailsPromise&&staticLotDetailsPromise.returnCode===1&&staticLotDetailsPromise.data.lotDetails)return staticLotDetailsPromise.data.lotDetails;return null};self.updateTitleAndDescMetaData=function($route,staticLotDetails,
path){if(self.getPhotosIdFromParams(path)=="Photos"){$route.current.$$route.titleKey="app.lotPhotos.title";$route.current.$$route.descKey="app.lotPhotos.description"}else{$route.current.$$route.titleKey="app.lotdetails.title";$route.current.$$route.descKey="app.lotdetails.description"}$rootScope.$emit("meta-args-update",{lotDesc:staticLotDetails.ld,yardName:staticLotDetails.yn,saleDate:getFormattedSaleDate(staticLotDetails)})};self.setWatchListDefinition=function(url){watchListService.setWatchListDefinition(url)};
self.showRegularView=function(showAllPhotos){return!(showAllPhotos&&(showAllPhotos.toUpperCase()=="ALL"||showAllPhotos.toUpperCase()=="PHOTOS"))};self.getOffSiteYardDetails=function(staticLotDetails){var deferred=$q.defer();if(staticLotDetails.offFlg){var offSiteYardSuccessCallBack=function(response){if(response&&response.data&&response.data.data&&response.data.data.offSiteYard)staticLotDetails.offsiteYard=response.data.data.offSiteYard||{};deferred.resolve(staticLotDetails.offsiteYard)};dataServiceG2.getOffisteYard(staticLotDetails.lotId,
offSiteYardSuccessCallBack)}return deferred.promise};self.showQuoteInDelivery=function(dynamicLotDetails){return dynamicLotDetails.lotAuctionStatus=="COUNTER_BIDDING"&&(dynamicLotDetails.bidStatus=="PAID"||dynamicLotDetails.bidStatus=="PAYMENT_DUE")};self.showEstimateInDelivery=function(dynamicLotDetails){return dynamicLotDetails.lotAuctionStatus!="COUNTER_BIDDING"};self.getInspectorLink=function(lotDetails,showInspectorLink,$event){var vehCodes=["VEHTYPE_L","VEHTYPE_M","VEHTYPE_R","VEHTYPE_S","VEHTYPE_U",
"VEHTYPE_H","VEHTYPE_J","VEHTYPE_K"];var externalInspLinkYards=userConfig.defaultDisplayPref.externalInspLinkYards;var isExternalInspLink=vehCodes.indexOf(lotDetails.vehicleTypeCode)>=0;var href="./inspectors?page\x3d1\x26yardNum\x3d"+lotDetails.phynumb||lotDetails.ynumb;self.memberPickupRolloutVO=copartUser.getUserConfig().defaultDisplayPref.memberPickupRolloutVO||{};self.hasVIRolledOutToAllStates=self.memberPickupRolloutVO.hasVIRolledOutToAllStates;self.vehInspStates=self.memberPickupRolloutVO.vehInspStates||
{};var isThirdPartyInsp=self.hasVIRolledOutToAllStates||_.contains(self.vehInspStates,lotDetails.locState);if($event){if(isExternalInspLink||isThirdPartyInsp){href="/content/"+appInit.regionCode+"/"+appInit.userLang+"/landing-page/third-party-inspections";$event.target.setAttribute("target","_blank")}$event.target.setAttribute("href",href)}};self.callBidEligibilityService=function(bidInquiryVO,lotDetails){try{bidInquiryVO=bidInquiryVO||{};var yardObj=appConfig.yardsMap[bidInquiryVO.yardNumber]||{};
if(copartUser.hasAccessPrivilege("LOG_BID_ELIGIBILITY")&&!yardObj.bidEligibilityWSEnabled){var bidInquiryVOArray=[];bidInquiryVO.buyerNumber=userService.userConfig.buyerNumber;bidInquiryVOArray.push(bidInquiryVO);dataServiceG2.logBidEligibility(bidInquiryVOArray,lotDetails)}}catch(e){log.error("Error occurred while calling bid eligibility service",e)}};self.getValidHighLightIcons=function(iconCodes){var iconCodesObjArray=[];var showHighlightIconsArray=_.where(appConfigService.appConfig.getHighlightIcons(),
{iconType:"H"});_.each(iconCodes,function(iconCodeObj){_.find(showHighlightIconsArray,function(obj){if(obj.iconCode==iconCodeObj){iconCodesObjArray.push(obj);return true}})});return iconCodesObjArray};self.getPhotosIdFromParams=function(path){if(path!=null&&path.indexOf("Photos")!=-1)return"Photos";return""}}]);"use strict";
app.service("memberChoicesService",["dataServiceG2","appConfigService","$locale","$sce","config",function(dataServiceG2,appConfigService,$locale,$sce,config){var log=new Logger({name:"memberChoicesService"});var locale=new LocaleService($locale,$sce,config);var self=this;self.memberChoices=null;var selectedChoices={};self.init=function(){selectedChoices={}};self.getSelectedChoices=function(){return selectedChoices};self.setSelectedChoices=function(questionCode,choiceTypes){if(choiceTypes&&choiceTypes.length>
0)selectedChoices[questionCode]=choiceTypes;else delete selectedChoices[questionCode]};self.getSelectedChoicesAsArray=function(){return _.values(self.getSelectedChoices())};self.getQuestion=function(choiceTypeCode){try{var memChoices=self.getMemberChoices();return memChoices&&memChoices[choiceTypeCode]?memChoices[choiceTypeCode][0]:null}catch(e){log.error("Error in fetching the choices for code {}-\x3e ",choiceTypeCode,e);return null}};self.getMemberChoices=function(){if(!self.memberChoices){var defaultMemberChoices=
appConfigService.appConfig.getDefaultMemberChoices();self.memberChoices=_.groupBy(defaultMemberChoices,"questionCode")}return self.memberChoices};self.addChoiceSelection=function(choiceArray,choiceType){choiceArray=choiceArray||[];choiceArray.push(choiceType);return choiceArray};self.removeChoiceSelection=function(choiceArray,choiceType){choiceArray=choiceArray||[];choiceArray.splice(choiceArray.indexOf(choiceType),1);return choiceArray};self.updateChoiceSelections=function(questionCode,choiceType,
replaceChoices){var choicesArray=self.getSelectedChoices()[questionCode]&&!replaceChoices?self.getSelectedChoices()[questionCode]:[];if(self.verifyIfChoiceExists(choicesArray,choiceType))choicesArray=self.removeChoiceFromArray(choicesArray,choiceType);else if(choiceType){choiceType.selected=true;choicesArray.push(choiceType)}self.setSelectedChoices(questionCode,choicesArray)};self.displaySelectedChoices=function(questionCode){var choiceAnswers=self.getSelectedChoices()[questionCode]||[];return choiceAnswers};
self.verifyIfChoiceExists=function(choiceArray,choiceType){return _.some(choiceArray,function(choice){return choice.answerCode==choiceType.answerCode})};self.removeChoiceFromArray=function(choiceArray,choiceType){return _.reject(choiceArray,function(choice){return choice.answerCode==choiceType.answerCode})}}]);
app.factory("urlStore",[function(){return{redirectUrl:"/dashboard/",dashboard:"/dashboard/",pwdExpired:"/expiredPassword/",forgetPassword:"/expiredPassword/?fp\x3dtrue",updateBrokerBidderEmail:"/updateBrokerBidderEmail/",login:"/login",lotDetailUrl:"/lotDetail/",noWatchlistLots:"/noResults/watchlist",noLotsFound:"/noResults/lots",home:"/",protectedUrls:["/Content/US/en/Premier-Member-Fees","/memberFees"]}}]);
app.factory("urlService",["$location","$filter","userService","auctionsCalendarService","$q","$sce","$routeParams","$rootScope","copartUser","copartUtils","appConfigService","$window",function($location,$filter,userService,auctionsCalendarService,$q,$sce,$routeParams,$rootScope,copartUser,copartUtils,appConfigService,$window){return{redirectUrl:"/dashboard/",dashboard:"/dashboard/",pwdExpired:"/expiredPassword/",forgetPassword:"/expiredPassword/?fp\x3dtrue",updateBrokerBidderEmail:"/updateBrokerBidderEmail/",
login:"/login",lotDetailUrl:"/lotDetail/",noWatchlistLots:"/public/fetchDirective.html?directive\x3dwatchlist/noItemsWatchList",noLotsFound:"/public/fetchDirective.html?directive\x3dvehicleFinder/noSearchFound",home:"/",missingSecurityQuestions:"/collect-security-questions",singleSignOnStart:"/sso/signon/start/",getContentURL:function(context){var url=appInit.localeString+"/Content/"+appInit.regionCode+"/"+appInit.localeString;if(context)url+="/"+context;console.log("URL generated as :"+url);return url},
getURLProtocol:function(){return $location.protocol()},getHeadingForURL:function(url,locale){if(url.indexOf("/watchList")!=-1)return locale.messages["app.label.myWatchList"];else if(url.indexOf("saleListResult")!=-1){var location=$location.search().displayStr;if(_.isUndefined(location))location=$location.search().location;if(_.isUndefined(location)&&url.indexOf("saleListResult")!=-1){location=$filter("filter")(referenceDataLess.yardLocations,{"yardNumber":url.substring(url.lastIndexOf("/")+1,url.length)});
if(!_.isUndefined(location)&&location.length>0)location=location[0].yardName}$rootScope.$emit("meta-args-update",{searchText:location});return locale.messages["app.label.saleListFor"]+" "+location}else if(url.indexOf("vehicleFinderSearch")!=-1){var displayStr=$location.search().displayStr;$rootScope.$emit("meta-args-update",{searchText:displayStr});return locale.messages["app.label.searchResultsFor"]+" "+displayStr}else if(url.indexOf("/search/")!=-1||url.indexOf("/quickpick/")!=-1){var displayStr=
$location.search().displayStr;$rootScope.$emit("meta-args-update",{searchText:displayStr});return locale.messages["app.label.searchResultsFor"]+" "+displayStr}else return locale.messages["app.label.search.results"]},getSubHeaderForURL:function(url,locale){var deferred=$q.defer();if(url.indexOf("saleListResult")!=-1){var view_location=locale.messages["app.label.viewLocation"];var sale_date_time=locale.messages["app.label.saleDateTime"];var pre_bid_ends=locale.messages["app.label.preBidEnds"];var yardNum=
$location.search().yardNum||$routeParams.yard;auctionsCalendarService.auctionByYard(yardNum).then(function(auction){var saleDate=parseInt($location.search().saleDate);var yardNum=$routeParams.yard;if(!_.isUndefined(saleDate)&&!isNaN(saleDate))if("Future"==saleDate)deferred.resolve(sale_date_time+" "+saleDate+" (\x3ca class\x3d'cursor-pointer' data-uname\x3d'lotLocation' location-modal yard-number\x3d'"+yardNum+"' yard-details\x3d'yardDetails' show-inventory\x3dfalse\x3e"+view_location+"\x3c/a\x3e)");
else{var date=moment(saleDate);var preBidStart=moment(saleDate);var prelimOffset=auction.endOfPreBid,prelimOffsetParts=prelimOffset.split(":"),hourDelta=prelimOffsetParts[0],minuteDelta=prelimOffsetParts[1];preBidStart.subtract({hours:hourDelta,minutes:minuteDelta});var dateTimeFormat=userService.userConfig.dateFormat+" "+userService.userConfig.timeFormat+" zz";var dateStr=date.tz(userService.userConfig.selectedTimezone).format(dateTimeFormat);var preBidStartStr=preBidStart.tz(userService.userConfig.selectedTimezone).format(dateTimeFormat);
if(date.isValid()&&preBidStart.isValid())deferred.resolve(sale_date_time+" "+dateStr+" "+pre_bid_ends+" "+preBidStartStr+" (\x3ca class\x3d'cursor-pointer' data-uname\x3d'lotLocation' location-modal yard-number\x3d'"+yardNum+"' yard-details\x3d'yardDetails' show-inventory\x3dfalse\x3e"+view_location+"\x3c/a\x3e)");else deferred.resolve()}else deferred.resolve()})}else deferred.resolve();return deferred.promise},getNoResultsURL:function(url){if(url.indexOf("/watchList")!=-1)return this.noWatchlistLots;
else return this.noLotsFound},getAllLaneSaleListResultUrl:function(auction){return this.getSaleListResultUrl(auction,false)},getSaleListResultUrl:function(auction,byLane){var liveAuction=auction.liveAuction==true?true:false;var date2;if(auction.hasOwnProperty("auctionDateSolr")){var auctionDate=String(auction.auctionDateSolr.dateAsInt);var date1=moment(new Date(auctionDate.substring(0,4),parseInt(auctionDate.substring(4,6))-1,auctionDate.substring(6,8)));date2=date1.format("YYYY-MM-DD")}else date2=
auction.auctionDate?copartUtils.formatCopartDate(auction.auctionDate.dateAsString):undefined;var baseUrl="/saleListResult/";var uri=null;if(auction.auctionId)uri="auctionId/"+auction.auctionId;else uri=auction.yardNumber+"/"+date2;if(byLane&&auction.lane)uri=uri+"/"+auction.lane;var auctionHostId;var auctionHostName;if(auction.auctionHostName&&auction.auctionId){auctionHostName=auction.auctionHostName;auctionHostId=auction.auctionId}else{auctionHostName=auction.saleName||$filter("saleNameFilter")(auction.yardName,
auction.isVirtual);auctionHostId=auction.yardNumber}var saleDate=auction.currentSaleTimeEpoch||auction.saleUtcDateTime;return baseUrl+uri+"?location\x3d"+auctionHostName+"\x26saleDate\x3d"+saleDate+"\x26liveAuction\x3d"+liveAuction+"\x26from\x3d"+"\x26yardNum\x3d"+auctionHostId},getLocationUrl:function(yardNumber){if(appConfigService&&appConfigService.getAppConfig().yardsMap){var yard=appConfigService.getAppConfig().yardsMap[yardNumber];if(yard&&yard.locationUrl)return yard.locationUrl}return"/locationDetail/"+
yardNumber},getSiteUrlFromLocation:function(){return $location.$$protocol+"://"+$location.host()},getAuctionURIWithLotNumber:function(auctionHostId,auctionLane,lotId){return"./auctionDashboard?auctionDetails\x3d"+auctionHostId+"-"+auctionLane+"-"+lotId},saveStateToRouteHistory:function(paramMap){$window.history.replaceState(paramMap,"",$window.location.href)},removeStateFromRouteHistory:function(){$window.history.replaceState(null,"",$window.location.href)}}}]);
app.service("functionQueueService",["$location",function($location){var self=this;var functionQueue=[];self.addToQueue=function(funcCall){functionQueue.push(funcCall)};self.executeQueue=function(){for(var i=0;i<functionQueue.length;i++){var funcCall=functionQueue[i];funcCall.funcRef(funcCall.paramArr[0])}functionQueue=[]}}]);app.factory("History",function(){return{lastRoute:{},secondLastRoute:{}}});
app.factory("licenseUploadFactory",function(){return{params:{"applicationName":"G2MBR","destination":"CAS","fileType":"DOCUMENT","documentType":"BUYER_LICENSE","objectType":"MEMBER"}}});
app.service("siteCatalyst",["userService",function(userService){var self=this;var valQueue={};self.addToQueue=function(fname,val){valQueue[fname]=val};self.executeCall=function(fname){var val=AppUtils.isUndefined(fname)?null:valQueue[fname];valQueue[fname]=null;if(!AppUtils.isUndefined(val))try{var memNumber=userService.userConfig.buyerNumber;copartOmnitureCall(fname,val["lotId"],memNumber,val["linkName"],val["download"],val["addremove"],val["channel"],val["pagename"],val["server"],val["ipaddress"],
val["country"],val["state"],val["city"],val["zipcode"],val["yardname"],val["type"],val["doctitle"],val["widgetName"],memNumber,val["selectedLanguage"],memNumber,val["videoUrl"],val["imageNumber"],val["tag"])}catch(e){console.log("error executing site catalyst call")}};self.doTagPageView=function(pageName){try{if(window.location.hash!="#data\x3drefresh"){var prefix="";if(userService.isAnonymous())prefix="public:";else prefix="member:";s.pageName=prefix+pageName;s.channel="public";s.pageType="";lm.Omniture.PageName=
s.pageName;s.prop1=s.pageName;var s_code=s.t();if(s_code)document.write(s_code);lm.Omniture.ClearVars()}else window.location.hash=""}catch(e){log.error("Site Catalyst call unsuccessful")}}}]);app.service("smoothScroll",["deviceService",function(deviceService){var self=this;self.targetElement=function(elemId){if(deviceService.isMobileSizeOrDevice())jQuery(document).ready(function(){jQuery("html, body").animate({scrollTop:$("#"+elemId).offset().top},300)},false)}}]);
app.service("openAccordionService",[function(){var self=this;self.targetAccordion=function(elem){jQuery("#"+elem).trigger("click")}}]);
app.service("errorHandler",["constants","dataServiceG2",function(constants,dataServiceG2){var self=this;self.locale=dataServiceG2.getLocale();self.handleErrors=function(errorObjs,prefix){var prefixForErrMsg=prefix?prefix.trim():"";var errors=[];console.log("Error handler errors: ",errorObjs);if(errorObjs instanceof Array&&!_.isEmpty(errorObjs))_.each(errorObjs,function(errorObj){if(errorObj.code&&self.locale.messages[prefixForErrMsg+errorObj.code])errors.push(self.locale.messages[prefixForErrMsg+
errorObj.code]);else if(errorObj.code&&self.locale.messages["app.label.error."+errorObj.code])errors.push(self.locale.messages["app.label.error."+errorObj.code]);else errors.push(self.locale.messages["app.error.global.text"])});else if(!_.isEmpty(errorObjs))if(errorObjs.code||errorObjs.message||errorObjs.errorMsg)errors.push(self.locale.messages[prefixForErrMsg+errorObjs.code]||errorObjs.message||errorObjs.errorMsg);else errors.push(self.locale.messages["app.error.global.text"]);return errors}}]);
"use strict";
app.service("vehicleFinderService",["dataServiceG2","$interval","appConfigService","$q","userService",function(dataServiceG2,$interval,appConfigService,$q,userService){var log=new Logger({name:"vehicleFinderService"});var self=this;self.appConfig=appConfigService.getAppConfig();self.locationsByInventory={};var vehicleFinderPreference=userService.userConfig.vehicleFinderPreference||{};self.vehicleTypes=self.appConfig.vehicleTypes||{};var updateLocationsByInventory=function(){var deferred=$q.defer();
dataServiceG2.fetchLocationsByInventory(function(response){if(response.returnCode!=-1){self.setLocationsByInventory(response.data.locationsByInventory);deferred.resolve(response.data.locationsByInventory)}else{deferred.resolve({});log.error("vehicleFinderService -\x3e Failed to get the locationsList"+error)}},function(error){deferred.reject("vehicleFinderService -\x3e Failed to get the locationsList");log.error("vehicleFinderService -\x3e Failed to get the locationsList"+error)});return deferred.promise};
var refreshLocationsByInventory=function(){$interval(updateLocationsByInventory,18E5)};refreshLocationsByInventory();self.setLocationsByInventory=function(locationsList){self.locationsByInventory=locationsList};self.getLocationsByInventory=function(){if(_.isNull(self.locationsByInventory)||_.isEmpty(self.locationsByInventory))return updateLocationsByInventory();var deferred=$q.defer();deferred.resolve(self.locationsByInventory);return deferred.promise};self.getDefaultVehicleType=function(vehicleTypes){if(!vehicleTypes)return;
var defaultVehicleType={code:vehicleFinderPreference.defVehicleType||"V"};if(vehicleFinderPreference.category)defaultVehicleType.category=vehicleFinderPreference.category;return _.findWhere(vehicleTypes,defaultVehicleType)||self.vehicleTypes[0]};self.getMakes=function(vehicleTypeObj){return appConfigService.getVehicleMakes(vehicleTypeObj,vehicleFinderPreference.filterByVehType)};self.getModels=function(vehicleTypeObj,vehicleMakeObj){return appConfigService.getVehicleModels(vehicleTypeObj,vehicleMakeObj,
vehicleFinderPreference.filterByVehType)}}]);
app.service("ConditionReportService",["dataServiceG2","$location","$cookies","trimFilter","appConfigService",function(dataService,$location,$cookies,trimFilter,appConfigService){var self=this;self.baseAmount=0;self.baseAmountVAT=0;self.totalCnVFeeInclVAT=0;var conditionReportEnabled=appConfigService.getEnvConfigProps().conditionReportEnabled;self.conditionReportChecks=function(lotDetails,dynamiclotDetails,showModal,confirmDialogue){if(!lotDetails)return;var auctionTime=lotDetails.ad?lotDetails.ad:
0;var queryString=lotDetails.phynumb+"?lotAuctionStatus\x3d"+dynamiclotDetails.lotAuctionStatus+"\x26auctionTime\x3d"+auctionTime+"\x26future\x3d"+lotDetails.ifs;dataService.conditionReportPreChecks(lotDetails,dynamiclotDetails,queryString,function(response){if(response&&response.returnCode>0)$location.path("condition-report/lot/"+lotDetails.ln);else{var errorCode=response.data.errorObject;if(_.isFunction(showModal))if(errorCode.startsWith("condition.report.purchase.allowed")){var purchasePrice=errorCode.substring(errorCode.indexOf("-")+
1);confirmDialogue(globalLocale.getMessageStr("app.lotdetails.cr.payForCR"),purchasePrice,lotDetails.ln,function(response){if(response)self.payForConditionReport(lotDetails.ln,lotDetails.phynumb,lotDetails.paymentMethod)})}else if(errorCode=="condition.report.purchase.not.allowed")jQuery("#CRIneligibility").modal("show");else if(errorCode=="condition.report.is.unavailable")showModal(globalLocale.getMessageStr("condition.report.is.unavailable"));else showModal(globalLocale.getMessageStr(errorCode))}})};
self.payForConditionReport=function(lotNumber,yardNumber,paymentMethod){var requestParam={};requestParam.GATEWAY_URL_KEY="CONDITION_REPORT";requestParam.cancelCallBackUrl="lot/"+lotNumber;requestParam.successCallBackURL="redirect-from-payments/cr/"+lotNumber+"/"+yardNumber;requestParam.pay=paymentMethod;var conditionReportVO={};conditionReportVO.lotNumber=lotNumber;conditionReportVO.baseAmount=self.baseAmount;conditionReportVO.baseAmountVAT=self.baseAmountVAT;conditionReportVO.totalCnVFeeInclVAT=
self.totalCnVFeeInclVAT;dataService.getTransactionIdForCR(conditionReportVO,function(response){if(response.returnCode>0){requestParam.transactionId=response.data;dataService.setPciParam(requestParam,function(response){if(response.returnCode>0)window.location.href=trimFilter(response.data.pciURL);else console.error("Error in Gateway/purchaseConditionReport")})}else return})};self.handleCrReportCallback=function(lotNumber,yardNumber,showModal){var isCROrdered=true;if($cookies.get("CrReportOrdered")){var value=
$cookies.get("CrReportOrdered");if(value=="success")showModal(globalLocale.getMessageStr("app.lotdetails.cr.so.success"),isCROrdered);else if(value=="validationFailure")showModal(globalLocale.getMessageStr("condition.report.so.validation.failed"),!isCROrdered);else showModal(globalLocale.getMessageStr("Service order couldn't be created at this moment. Please retry later."),!isCROrdered);$cookies.remove("CrReportOrdered")}};self.getConditionReportData=function(lotNumber,callback){dataService.getConditionReportData(lotNumber,
callback)};self.getConditionReportApi=function(lotNumber,conditionReportToken,callback){var headersParams={"conditionReportToken":"Bearer "+conditionReportToken,"country":"US","source":"mobile","partner":"en"};dataService.getConditionReportApi(lotNumber,headersParams,callback)};self.setDisplayConditionReportFlag=function(lotDetails,userConfig){var yardsNotEligibleForCR=userConfig.defaultDisplayPref.yardsEligibleForCR;var isYardNotEligibleForCR=false;if(yardsNotEligibleForCR!=undefined)isYardNotEligibleForCR=
yardsNotEligibleForCR.indexOf(lotDetails.phynumb+"")>-1;if(userConfig.isNonSyncedBuyer)return lotDetails.viewVehicleCRLink=false;var isCREligible=true;lotDetails.viewVehicleCRLink=lotDetails&&userConfig&&conditionReportEnabled?isCREligible&&((lotDetails.brand==="CANADA"||lotDetails.brand==="COPART")&&userConfig.companyCode==="COPART"||userConfig.companyCode==="COPARTUK"&&!(lotDetails.td.indexOf("CAT B")!=-1)&&lotDetails.vehicleTypeCode.indexOf("VEHTYPE_V")!=-1&&!isYardNotEligibleForCR)&&(!lotDetails.offFlg&&
lotDetails.syn!=="*VIX*"&&!lotDetails.slfg)&&lotDetails.vehTypDesc==="AUTOMOBILE":false;return lotDetails.viewVehicleCRLink};function showCRModal(message){var modalElement=$("#conditionReport");modalElement.find("p").html(message);modalElement.modal("show")}}]);
app.service("copartVideosService",["$rootScope",function(rootScope){var self=this;self.validateAndFrameYouTubeUrl=function(url){if(url!=undefined||url!=""){var regExp=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=|\?v=)([^#\&\?]*).*/;var match=url.match(regExp);if(match&&match[2].length==11)return"https://www.youtube.com/embed/"+match[2]+"?autoplay\x3d1\x26enablejsapi\x3d1\x26rel\x3d0";else{console.log("url not valid");return""}}}}]);"use strict";
app.service("subscriptionsService",["appConfigService","constants",function(appConfigService,constants){var self=this;self.subscriptionSelectAll=function(subscription){if(subscription.selectAllSubscriptions){subscription.subscriptionStatus=true;subscription.textSubscriptionStatus=true;subscription.webSubscriptionStatus=true;subscription.emailSubscriptionStatus=true;subscription.phoneSubscriptionStatus=true}else{subscription.subscriptionStatus=false;subscription.textSubscriptionStatus=false;subscription.webSubscriptionStatus=
false;subscription.emailSubscriptionStatus=false;subscription.phoneSubscriptionStatus=false}};self.updateSelectAll=function(subscription){subscription.selectAllSubscriptions=subscription.textSubscriptionStatus&&subscription.webSubscriptionStatus&&subscription.emailSubscriptionStatus&&subscription.phoneSubscriptionStatus};self.getSubscriptionVOListFromMap=function(subscriptionVOMap){return _.values(subscriptionVOMap)};self.memberPreferences={"MKT_NEWS_US":["MKT_NEWS"]};self.subscriptionPreferences=
[];self.getSubscriptionsForSubscriptionCode=function(subscriptionCode){if(_.isEmpty(self.subscriptionPreferences))self.subscriptionPreferences=appConfigService.getAppConfig().getSubscriptionPreferences()||[];var subscriptionsList=[];angular.forEach(self.subscriptionPreferences,function(subsciption){if(subsciption.subscriptionCode==subscriptionCode){var subscriptionObj=angular.copy(subsciption);subscriptionObj.subscriptionStatus=constants.NOT_SUBSCRIBED;subscriptionObj.isChecked=false;subscriptionsList.push(subscriptionObj)}},
subscriptionsList);return subscriptionsList};self.getAvailableSubscriptions=function(prefCode){var subscriptionsList=[];var subscriptions=self.memberPreferences[prefCode];angular.forEach(subscriptions,function(subsciption){var subscriptionObj={};subscriptionObj.subscriptionPreferenceCode=prefCode;subscriptionObj.subscriptionStatus=self.NOT_SUBSCRIBED;subscriptionObj.subscriptionCode=subsciption;subscriptionObj.isChecked=false;subscriptionsList.push(subscriptionObj)},subscriptionsList);return subscriptionsList}}]);
"use strict";
app.service("singleSignOnService",["copartUser","urlService","copartUtils",function(copartUser,urlService,copartUtils){var log=new Logger({name:"singleSignOnService"});var self=this;self.isEligibleForSingleSignOn=function(brand){return copartUser.hasAccessPrivilege("SINGLE_SIGN_ON")&&brand=="DRIVE"};self.getSingleSignOnUrl=function(url,brand){var queryParamObj={redirectUrl:encodeURIComponent(copartUser.getLocationUrlWithLocale(url))};var baseUrl=urlService.singleSignOnStart+brand.toLowerCase();return copartUtils.appendQueryStringToURL(baseUrl,
queryParamObj)}}]);app.service("invoiceService",["$location","dataServiceG2",function($location,dataServiceG2){var self=this;self.getInvoiceDocuments=function(invoiceNumber,docType,entity,callBack){dataServiceG2.getInvoiceDocuments(invoiceNumber,docType,entity,callBack)}}]);
app.service("userLocationService",["$http","$q","dataServiceG2","localStorageService",function($http,$q,dataServiceG2,localStorageService){var log=new Logger({name:"userLocationService"});var self=this;self.globalPromise=null;self.getUserLocationInfo=function(){var deferred;if(self.globalPromise)return self.globalPromise;deferred=$q.defer();var locationInfo=localStorageService.cookie.get("locationInfo");if(locationInfo){deferred.resolve(locationInfo);return deferred.promise}dataServiceG2.userLocationInfo(function(response){if(response.returnCode!=
-1&&!_.isEmpty(response.data)&&!_.isUndefined(response.data.countryCode)){localStorageService.cookie.set("locationInfo",response.data,7);deferred.resolve(response.data)}else{log.error("Error getting LocationInfo -\x3e Failed "+response);deferred.reject()}self.globalPromise=null},function(error){log.error("Failed to fetch locationInfo -\x3e Failed "+error);deferred.reject()});self.globalPromise=deferred.promise;return self.globalPromise}}]);
app.service("homeQuickpicksService",["$q","dataServiceG2","$interval","appConfigService",function($q,dataServiceG2,$interval,appConfigService){var log=new Logger({name:"homeQuickpicksService"});var self=this;self.popularSearch={};self.lotRecommendations={};self.popularSearchGlobalPromise=null;self.lotRecGlobalPromise=null;var homePageRefreshInterval=appConfigService.getEnvConfigProps().homePageRefreshInterval;self.getPopularSearch=function(popularSearchCriteria){var deferred;if(self.popularSearchGlobalPromise)return self.popularSearchGlobalPromise;
deferred=$q.defer();if(!_.isEmpty(self.popularSearch)){deferred.resolve(self.popularSearch);return deferred.promise}dataServiceG2.popularSearches(popularSearchCriteria,function(response){if(response.returnCode!=-1&&!_.isEmpty(response.data)){self.popularSearch=response.data;self.popularSearch=frameUri(self.popularSearch);self.popularSearch=self.popularSearch.lotModelGroup.concat(self.popularSearch.lotMakeDesc);deferred.resolve(self.popularSearch)}else{log.error("popularSearchesCall -\x3e Failed "+
response);deferred.reject()}self.popularSearchGlobalPromise=null},function(error){log.error("popularSearchesCall -\x3e Failed "+error);deferred.reject()});self.popularSearchGlobalPromise=deferred.promise;return self.popularSearchGlobalPromise};self.getLotRecommendations=function(lotSearchCriteria){var deferred;if(self.lotRecGlobalPromise)return self.lotRecGlobalPromise;deferred=$q.defer();if(!lotSearchCriteria.updateLotRecommendations&&!_.isEmpty(self.lotRecommendations)&&_.isEmpty(lotSearchCriteria.lotNumber)){deferred.resolve(self.lotRecommendations);
return deferred.promise}dataServiceG2.lotRecommendationSearch(lotSearchCriteria,function(response){if(response.returnCode!=-1){self.lotRecommendations=response.data;deferred.resolve(response.data)}else{log.error("searchRecommendationCall -\x3e Failed to get the lot RecommendationCall"+response);deferred.reject()}self.lotRecGlobalPromise=null},function(error){log.error("searchRecommendationCall -\x3e Failed to get the lot RecommendationCall"+error);deferred.reject()});self.lotRecGlobalPromise=deferred.promise;
return self.lotRecGlobalPromise};var frameUri=function(popularSearches){for(var key in popularSearches)popularSearches[key]=popularSearches[key].map(function(pick){if(key==="lotModelGroup")return{name:pick,uri:"./popular/model/"+pick.toLowerCase().replace(/\s+/,"-").replace(/\//,"-")};else if(key==="lotMakeDesc")return{name:pick,uri:"./popular/make/"+pick.toLowerCase().replace(/\s+/,"-").replace(/\//,"-")}});return popularSearches};self.refereshPopularSearchData=function(){self.popularSearch={};self.lotRecommendations=
{}};$interval(self.refereshPopularSearchData,homePageRefreshInterval)}]);
app.service("driverSeatService",["$location",function($location){var self=this;self.columnDefs=[{"targets":[0],"orderable":false},{targets:"no-sort",orderable:false},{className:"control",orderable:false,targets:-1}];self.driverSeatViewMapping={"mylots":{"label":"mylots","urlToTrigger":"/data/driverseat/my-lots","viewSpecificColoums":["lotNumber","highBid","memberLotStatus",undefined],"csvUrl":"/data/driverseat/client/export-my-lots","csvFileName":"myLots","tableId":"#serverSideDataTable_mylots","dataTableOptions":{"hideUpdateBidCall":true,
"checkLotLiveAuctionStatus":true,"isdefaultSortingOnColumnNames":true,"initOrder":undefined,"defaultSortColumns":{"auction_date_utc":"desc"}}},"mybids":{"label":"mybids","urlToTrigger":"/data/driverseat/my-bids","viewSpecificColoums":["lotNumber","highBid","memberLotStatus",undefined],"csvUrl":"/data/driverseat/client/export-my-bids","csvFileName":"myBids_","tableId":"#serverSideDataTable_mybids","dataTableOptions":{"hideUpdateBidCall":true,"checkLotLiveAuctionStatus":true,"isdefaultSortingOnColumnNames":true,
"initOrder":undefined,"defaultSortColumns":{"auction_date_utc":"desc"}}},"mycounterbids":{"label":"mycounterbids","urlToTrigger":"/data/driverseat/my-counter-bids","viewSpecificColoums":["lotNumber","highBid","memberLotStatus",undefined],"csvUrl":"/data/driverseat/client/export-my-counter-bids","csvFileName":"myCounterBids_","tableId":"#serverSideDataTable_mycounterbids","dataTableOptions":{"hideUpdateBidCall":true,"checkLotLiveAuctionStatus":false,"isdefaultSortingOnColumnNames":true,"initOrder":undefined,
"defaultSortColumns":{"member_lot_status":"asc"}}},"lotswon":{"label":"lotswon","urlToTrigger":"/data/driverseat/lots-won","viewSpecificColoums":["lotNumber","highBid","memberLotStatus",undefined],"csvUrl":"/data/driverseat/client/export-lots-won","csvFileName":"lotsWon_","tableId":"#serverSideDataTable_lotswon","dataTableOptions":{"hideUpdateBidCall":true,"checkLotLiveAuctionStatus":false,"isdefaultSortingOnColumnNames":true,"initOrder":undefined,"defaultSortColumns":{"auction_date_utc":"desc"}}},
"paymentsdue":{"label":"paymentsdue","urlToTrigger":"/data/driverseat/my-payments-due-lots","viewSpecificColoums":["lotNumber","invoiceDate","salePrice","memberLotStatus",undefined],"csvUrl":"/data/driverseat/client/export-my-paymentsdue-lots","csvFileName":"paymentsdue_","tableId":"#serverSideDataTable_paymentsdue","dataTableOptions":{"hideUpdateBidCall":true,"checkLotLiveAuctionStatus":false,"isdefaultSortingOnColumnNames":true,"initOrder":undefined,"defaultSortColumns":{"invoice_date_utc":"desc"}}},
"titlestatus":{"label":"titlestatus","urlToTrigger":"/data/driverseat/my-lots-title-status","viewSpecificColoums":["lotNumber","invoiceAmount","paymentDueAmount","invoiceDate","paymentDate","titleMailedDate","lotLeftYardDate","salePrice","memberLotStatus",undefined],"csvUrl":"/data/driverseat/client/export-my-lots-title-status","csvFileName":"titlestatus_","tableId":"#serverSideDataTable_titlestatus","dataTableOptions":{"hideUpdateBidCall":true,"checkLotLiveAuctionStatus":false,"isdefaultSortingOnColumnNames":true,
"initOrder":undefined,"defaultSortColumns":{"title_mailed_date":"desc"}}},"tobepickeduplots":{"label":"tobepickeduplots","urlToTrigger":"/data/driverseat/my-lots-to-be-pickedup","viewSpecificColoums":["lotNumber","invoiceAmount","paymentDueAmount","invoiceDate","paymentDate","lotLeftYardDate","titleMailedDate","salePrice","memberLotStatus",undefined],"csvUrl":"/data/driverseat/client/export-my-lots-to-be-pickedup","csvFileName":"tobepickeduplots_","tableId":"#serverSideDataTable_tobepickeduplots",
"dataTableOptions":{"hideUpdateBidCall":true,"checkLotLiveAuctionStatus":false,"isdefaultSortingOnColumnNames":true,"initOrder":undefined,"defaultSortColumns":{"lot_left_yard_date_utc":"desc"}}},"lotshistory":{"label":"lotshistory","urlToTrigger":"/data/driverseat/my-lots-history","viewSpecificColoums":["lotNumber","invoiceAmount","paymentDueAmount","invoiceDate","paymentDate","lotLeftYardDate","salePrice","memberLotStatus",undefined],"csvUrl":"/data/driverseat/client/export-my-lots-history","csvFileName":"lotshistory_",
"tableId":"#serverSideDataTable_lotshistory","dataTableOptions":{"hideUpdateBidCall":true,"checkLotLiveAuctionStatus":false,"applyNoOfDaysFilter":true,"isdefaultSortingOnColumnNames":true,"initOrder":undefined,"defaultSortColumns":{"lot_left_yard_date_utc":"desc"}}}};self.customColumnsOptions={"length":7,"url":"/data/driverSeatCustomViewPref","colMappingField":"memberLotSearchCustomColumns"};self.getCustomColumDef=function(){return self.customColumnsOptions};self.getColumnsDef=function(){return self.columnDefs};
self.driverSeatView=function(view){return self.driverSeatViewMapping[view]};self.getdriverSeatViewMappings=function(){return self.driverSeatViewMapping};self.dateRanges=[30,60,90,180,365];self.getDateRanges=function(){return self.dateRanges}}]);
app.service("creditCardService",["dataServiceG2","appConfigService","copartUser","constants",function(dataServiceG2,appConfigService,copartUser,constants){var log=new Logger({name:"creditCardService"});var self=this;var selectedTimezone=copartUser.getUserConfig().selectedTimezone;self.currentYear=moment().tz(selectedTimezone).year();self.maxCreditCardYearsIntoFuture=constants.MAX_CREDIT_CARD_YEARS_INTO_FUTURE;self.cvvMonths=["01","02","03","04","05","06","07","08","09","10","11","12"];self.countryList=
appConfigService.appConfig.getCountries();self.statesList=appConfigService.appConfig.getCountryStates();self.availableCardTypes=function(){return constants.CARD_TYPES};self.getCVVYears=function(){var values=[];for(var i=self.currentYear;i<=self.currentYear+self.maxCreditCardYearsIntoFuture;i+=1)values.push(i);return values};self.getCVVMonths=function(){return self.cvvMonths};self.getAvailableCardTypes=function(){return self.availableCardTypes()};self.getCountryList=function(){return self.countryList};
self.getStatesList=function(){return self.statesList}}]);
app.service("shippingService",["$location",function($location){var self=this;var data={};self.setLotNumber=function(lotNumber){data.lotNumber=lotNumber};self.getLotNumber=function(){return data.lotNumber};self.setDestinationCountryName=function(countryName){data.destinationCountryName=countryName};self.setDestinationCountryCode=function(countryCode){data.destinationCountryCode=countryCode};self.getDestinationCountryName=function(){return data.destinationCountryName};self.getDestinationCountryCode=
function(){return data.destinationCountryCode};self.setPort=function(port){data.port=port};self.getPort=function(port){return data.port}}]);
app.service("membershipService",["$rootScope","dataServiceG2","$q","userService",function(rootScope,dataServiceG2,$q,userService){var self=this;var membershipProductsPromise=null;self.isPromiseResolved=function(promise){return promise&&promise.$$state?promise.$$state.status==1:false};self.isPromisePending=function(promise){return promise&&promise.$$state?promise.$$state.status==0:false};self.getMembershipProductsWithPricing=function(refresh){var membershipProducts=null;if(refresh)membershipProductsPromise=
null;if(membershipProductsPromise)return membershipProductsPromise;var deferred=$q.defer();membershipProductsPromise=deferred.promise;dataServiceG2.membershipPricing(function(response){self.loadingPricingDetails=false;if(response&&response.data&&response.data.returnCode!==-1&&response.data.data)membershipProducts=response.data.data;deferred.resolve(membershipProducts)});return membershipProductsPromise}}]);
app.service("accountAlertsService",["copartUser","dataServiceG2","constants","$q",function(copartUser,dataServiceG2,constants,$q){var self=this;self.locale=dataServiceG2.getLocale();self.alerts=[];self.getAccountAlerts=function(){var deferred=$q.defer();self.alerts=[];var alerts=[];if(!alerts||alerts.length===0)dataServiceG2.getAccountAlerts().then(function(response){if(response&&response.data&&response.returnCode!==-1){alerts=response.data;self.alerts=alerts;deferred.resolve(alerts)}},function(error){console.log(error)});
if(alerts&&alerts.length>0){self.alerts=alerts;deferred.resolve(alerts)}return deferred.promise};self.getBannerAlerts=function(alerts){var bannerAlerts=undefined;if(alerts)for(var index=0;index<alerts.length;index++)if(alerts&&alerts[index]&&alerts[index]["alertCategory"]===constants.BANNER)bannerAlerts=alerts[index].alerts;return bannerAlerts};self.updateAccountAlerts=function(userActionCode){var deferred=$q.defer();self.removeAlert(userActionCode);return deferred.promise};self.updateDisplayAlertsModal=
function(value){copartUser.setDisplayAlertsModal(value);dataServiceG2.updateDisplayAlertsModal({"displayAlertsModal":value})};self.removeAlert=function(userActionCode){var deferred=$q.defer();if(userActionCode)dataServiceG2.updateAccountAlerts(self.generateRequestData(userActionCode)).then(function(response){if(response&&response.data&&response.returnCode!==-1){self.removeAlertBannerAndModalFromView(userActionCode);deferred.resolve(response.data)}},function(error){console.log(error);deferred.reject(error)});
return deferred.promise};self.removeAlertBannerAndModalFromView=function(userActionCode){jQuery("#carousel-banner #banner-"+userActionCode).remove();jQuery("#carousel-banner").children().removeClass("active");jQuery("#carousel-banner .item").first().addClass("active");jQuery("#alertsContent #modal-"+userActionCode).remove();jQuery("#alertsContent .item").first().addClass("active")};self.generateRequestData=function(userActionCode){var data={};var pendingActions=self.getAlertsFromUserActivity(self.alerts);
if(userActionCode&&pendingActions&&pendingActions.length>0)pendingActions.forEach(function(alert){if(userActionCode===alert.customUserActionCode){data.userActionId=alert.userActionId;data.actionStatus=constants.ALERTS_REMIND_LATER_STATUS}});return data};self.getAlerts=function(){return self.alerts};self.getPendingActionsFromUserActivity=function(userActivities){var pendingActions=[];if(userActivities&&userActivities.length>0)userActivities.forEach(function(activity){if(activity&&activity.accountAlerts&&
activity.accountAlerts.length>0)activity.accountAlerts.forEach(function(alert){pendingActions.push(alert)})});return pendingActions};self.getAlertsFromUserActivity=function(userActivities){var pendingActions=self.getPendingActionsFromUserActivity(userActivities);var alerts=[];for(var i=0;i<pendingActions.length;++i)if(pendingActions[i]&&pendingActions[i].actionStatus!==constants.ALERT_FILTER_ACTION_STATUS)alerts.push(pendingActions[i]);return alerts};self.verifyUserActivityCompleted=function(userActivities,
userActivity){if(userActivities&&userActivities.length>0&&userActivity)for(var i=0;i<userActivities.length;++i)if(userActivities[i].userActivity===userActivity)return userActivities[i].accountAlerts&&userActivities[i].accountAlerts.length===0;return true};self.verifyUserActionCompleted=function(userActivities,userAction){for(var i=0;i<userActivities.length;++i)if(userActivities[i]&&userActivities[i].userActionCode===userAction)return false;return true};self.verifyUserActionCompletedFromActivities=
function(userAction){var pendingUserActions=self.getPendingActionsFromUserActivity(self.alerts);for(var i=0;i<pendingUserActions.length;++i)if(pendingUserActions[i]&&pendingUserActions[i].userActionCode===userAction)return false;return true};self.verifyUserActivityCompletedByIgnoringAlert=function(userActivities,userActivity,ignoreAlert){if(userActivities&&userActivities.length>0&&userActivity)for(var i=0;i<userActivities.length;++i)if(userActivities[i].userActivity===userActivity&&userActivities[i].accountAlerts&&
userActivities[i].accountAlerts.length>0){var userActivitesAlertList=angular.copy(userActivities[i].accountAlerts);if(ignoreAlert)userActivitesAlertList=_.without(userActivitesAlertList,_.findWhere(userActivitesAlertList,{userActionCode:ignoreAlert}));return userActivitesAlertList&&userActivitesAlertList.length===0}return true};self.filterAlertsForUserViewFromUserActivities=function(userActivities){var pendingActions=[];if(userActivities&&userActivities.length>0)userActivities.forEach(function(activity){if(activity&&
activity.accountAlerts&&activity.accountAlerts.length>0)activity.accountAlerts.forEach(function(alert){pendingActions.push(alert)})});return _.uniq(pendingActions,function(action){return action.customUserActionCode})};self.getActivityFromList=function(userActivitiesList,userActivity){return _.find(userActivitiesList,{userActivity:userActivity})||{}};self.getActionFromList=function(userActionsList,userAction){return _.find(userActionsList,{userActionCode:userAction})||{}};var PENDING_ACTIONS_FOR_REGISTRATION=
[constants.ALERT_TYPE_STATUS.pendingMemPayment,constants.ALERT_TYPE_STATUS.missingAccInfo,constants.ALERT_TYPE_STATUS.noUploadDoc];self.isRegistrationComplete=function(){var activity=self.getActivityFromList(self.alerts,constants.REGISTRATION_USER_ACTIVITY);if(!_.isEmpty(activity)){var pendingActions=activity.accountAlerts;if(pendingActions&&pendingActions.length>0)for(var i=0;i<pendingActions.length;++i)if(_.contains(PENDING_ACTIONS_FOR_REGISTRATION,pendingActions[i].userActionCode))return false}return true};
self.isActionCompleteForActivity=function(activity,action){if(!activity&&!action)return false;var retrievedActivity=self.getActivityFromList(self.alerts,activity);if(!_.isEmpty(retrievedActivity))if(!_.isEmpty(self.getActionFromList(retrievedActivity.accountAlerts,action)))return false;return true}}]);
app.service("passwordValidationService",["copartUser","dataServiceG2","constants",function(copartUser,dataServiceG2,constants){var self=this;self.locale=dataServiceG2.getLocale();self.currentErrors={};self.handleServerSideErrors=function(currentErrors,errorsList){self.currentErrors=currentErrors;_.each(errorsList,function(error){self.validateFunc(error)});return self.currentErrors};self.msgPropPrefix="app.error.label.";self.validateFunc=function(errorObj){if(errorObj.field&&errorObj.code)switch(errorObj.field){case "password":self.currentErrors.password=
{};var msg=self.getMessage(self.msgPropPrefix,errorObj);if(msg&&msg.length>0){self.currentErrors.password.isError=true;self.currentErrors.password.errorMessage=msg}break;default:self.currentErrors.isErrorExists=true}else if(errorObj.code)self.currentErrors.isErrorExists=true};self.getMessage=function(msgPrefix,errorObj){if(self.locale.getMessage(self.msgPropPrefix+errorObj.code))return self.locale.getMessage(self.msgPropPrefix+errorObj.code).$$unwrapTrustedValue();return""}}]);
app.service("scrollToDivService",["$anchorScroll","$location",function($anchorScroll,$location){var self=this;self.scrollToDiv=function(targetDiv){var id=$location.hash();$location.hash(targetDiv);$anchorScroll();$location.hash(id)}}]);
app.service("googlepayService",["$q","dataServiceG2",function($q,dataServiceG2){var log=new Logger({name:"googlepayService"});var self=this;self.googlepayProperties={};self.getGooglePayProperties=function(){var deferred=$q.defer();if(!_.isEmpty(self.googlepayProperties)){deferred.resolve(self.googlepayProperties);return deferred.promise}dataServiceG2.getGooglePayEnvConfigProps().then(function(response){if(response.returnCode!=-1&&!_.isEmpty(response.data)){self.googlepayProperties=response.data;deferred.resolve(self.googlepayProperties)}else{log.error("fetch -\x3egooglepayProperties -\x3e Failed "+
response);deferred.reject(response)}},function(error){log.error("fetch -\x3egooglepayProperties -\x3e Failed "+error);deferred.reject(error)});return deferred.promise}}]);